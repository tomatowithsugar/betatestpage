<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶ˆê´‘ì„œë¶€íšŒì¤‘ ì „ì‹œëŒ€ ì‹ ì²­</title>
    <link rel="apple-touch-icon" href="apple-touch-icon_v3.png">
    <link rel="icon" type="image/png" href="favicon-512x512_v3.png">

    <!-- Firebase SDK -->
    <script type="module">import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, onSnapshot, deleteDoc, doc, setDoc, updateDoc, arrayUnion, arrayRemove, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';


        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyCUe4dXiwGiMsKtMCQfLVScx9iM4sEwF50",
            authDomain: "cart-witnessing-404c0.firebaseapp.com",
            projectId: "cart-witnessing-404c0",
            storageBucket: "cart-witnessing-404c0.firebasestorage.app",
            messagingSenderId: "616001042576",
            appId: "1:616001042576:web:314fe2268c8fffe82a8015",
            measurementId: "G-HT3T8YS1MW"
        };


        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ì „ì—­ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ window ê°ì²´ì— ì €ì¥
        window.firebaseApp = app;
        window.db = db;
        window.firestoreFunctions = {
            collection, addDoc, getDocs, query, where, onSnapshot, deleteDoc, doc, setDoc, updateDoc, arrayUnion, arrayRemove, getDoc
        };


        // DOMì´ ë¡œë“œëœ í›„ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', function () {
            window.initializeApp();
        });</script>

    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
:root {
  --base-font-size: 16px;
  --heading-font-size: 26px;
  --button-font-size: 17px;
  --label-font-size: 15px;
  --small-font-size: 13px;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(145deg, #667eea 0%, #764ba2 50%, #667eea 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 0;
    color: #1a202c;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}


.container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 0;
    border-radius: 0;
    box-shadow: none;
    width: 100%;
    max-width: 100%;
    min-height: 100vh;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

h1 {
    text-align: center;
    color: #1a202c;
    margin: 0;
    padding: 40px 20px 30px;
    font-size: 26px;
    font-weight: 800;
    line-height: 1.3;
    position: relative;
    z-index: 2;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.login-page, .main-page, .admin-page {
    padding: 20px;
    position: relative;
    z-index: 2;
    margin-top: 20px;
    flex-shrink: 0;
}

.login-page {
    display: block;
}

.main-page, .admin-page {
    display: none;
}

.form-group {
    margin-bottom: 24px;
}

label {
    display: block;
    margin-bottom: 10px;
    color: #2d3748;
    font-weight: 600;
    font-size: var(--label-font-size);
    text-align: left;
}

input[type="text"], select, textarea, input[type="number"] {
    width: 100%;
    padding: 18px 20px;
    border: none;
    border-radius: 16px;
    font-size: var(--base-font-size);
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(102, 126, 234, 0.2);
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}

input[type="text"]:focus, select:focus, textarea:focus, input[type="number"]:focus {
    outline: none;
    background: white;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), 0 8px 30px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.btn {
    width: 100%;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 16px;
    font-size: var(--button-font-size);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin-bottom: 14px;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.6s;
}

.btn:hover::before {
    left: 100%;
}

.btn:active {
    transform: scale(0.98);
}

.btn.secondary {
    background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
    box-shadow: 0 8px 25px rgba(160, 174, 192, 0.3);
}

.btn.danger {
    background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%);
    padding: 14px 20px;
    width: auto;
    font-size: 14px;
    margin: 0;
    box-shadow: 0 6px 20px rgba(252, 129, 129, 0.3);
    border-radius: 12px;
}

.btn.success {
    background: linear-gradient(135deg, #68d391 0%, #38a169 100%);
    padding: 16px 24px;
    width: auto;
    font-size: 15px;
    margin: 0 5px;
    box-shadow: 0 6px 20px rgba(104, 211, 145, 0.3);
    border-radius: 12px;
}

.btn.admin {
    background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
    box-shadow: 0 8px 25px rgba(246, 173, 85, 0.3);
}

.btn.small {
    padding: 16px 22px;
    font-size: var(--label-font-size);
    width: auto;
}

.btn:disabled {
    background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.user-info, .admin-info {
    text-align: center;
    margin: 20px 0 32px;
    font-size: 18px;
    font-weight: 600;
    padding: 20px;
    border-radius: 16px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.user-info {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    color: #667eea;
}

.admin-info {
    background: linear-gradient(135deg, rgba(246, 173, 85, 0.1) 0%, rgba(237, 137, 54, 0.1) 100%);
    color: #ed8936;
}

.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 14px;
    margin-bottom: 32px;
}

.admin-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-bottom: 32px;
}

.day-selection {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-top: 16px;
}

.zone-selection {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-top: 16px;
}

.day-option, .zone-option {
    position: relative;
}

.day-option input[type="radio"], .zone-option input[type="radio"] {
    display: none;
}

.day-label, .zone-label {
    display: block;
    padding: 20px 16px;
    border: none;
    border-radius: 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(102, 126, 234, 0.1);
    font-weight: 600;
    font-size: var(--label-font-size);
    position: relative;
    overflow: hidden;
}

.zone-label {
    padding: 24px 20px;
    font-size: var(--base-font-size);
}

.day-label::before, .zone-label::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.day-option input[type="radio"]:checked + .day-label,
.zone-option input[type="radio"]:checked + .zone-label {
    color: white;
    border-color: #667eea;
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
    transform: translateY(-2px);
}

.day-option input[type="radio"]:checked + .day-label::before,
.zone-option input[type="radio"]:checked + .zone-label::before {
    opacity: 1;
}

.day-label:active, .zone-label:active {
    transform: scale(0.98);
}

.date-info {
    font-size: var(--small-font-size);
    margin-top: 6px;
    color: #718096;
    font-weight: 500;
}

.day-option input[type="radio"]:checked + .day-label .date-info {
    color: rgba(255, 255, 255, 0.9);
}

.capacity-info {
    font-size: var(--small-font-size);
    margin-top: 8px;
    text-align: center;
    color: #718096;
    font-weight: 600;
    padding: 4px 8px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    display: inline-block;
}

.zone-label .capacity-info {
    font-size: var(--label-font-size);
}

.applicants-list {
    margin-top: 32px;
    padding: 0;
    background: none;
    border-radius: 0;
    flex-grow: 1;
    overflow-y: auto;
    max-height: calc(100vh - 300px);
}

.applicants-list h3 {
    margin-bottom: 20px;
    color: #1a202c;
    font-size: 20px;
    font-weight: 800;
    text-align: center;
    padding: 0 20px;
}

.day-section {
    margin-bottom: 16px;
    padding: 0;
    background: none;
    border-radius: 0;
}

.day-title {
    font-weight: 800;
    color: #667eea;
    margin-bottom: 12px;
    font-size: var(--button-font-size);
    padding: 0 20px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 16px 20px;
    margin: 0 20px 12px;
    border: 1px solid rgba(102, 126, 234, 0.1);
}

.zone-applicants {
    margin: 0 20px 10px;
    padding: 18px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.zone-name {
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 10px;
    font-size: var(--label-font-size);
}

.name-tag {
    display: inline-block;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 8px 14px;
    margin: 4px 6px 4px 0;
    border-radius: 20px;
    font-size: var(--small-font-size);
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
    position: relative;
    overflow: hidden;
}

.name-tag::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.6s;
}

.name-tag:hover::before {
    left: 100%;
}

.applicant-names {
    line-height: 1.8;
    color: #4a5568;
    font-size: var(--label-font-size);
}

.zone-selection-container {
    display: none;
}

.zone-selection-container.show {
    display: block;
    animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideUp {
    from { 
        opacity: 0; 
        transform: translateY(20px);
    }
    to { 
        opacity: 1; 
        transform: translateY(0);
    }
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(8px);
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    margin: 0;
    padding: 30px 20px;
    border-radius: 24px 24px 0 0;
    width: 100%;
    max-width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
    animation: slideUpModal 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideUpModal {
    from {
        transform: translateY(100%);
    }
    to {
        transform: translateY(0);
    }
}

.modal-content.large {
    max-width: 100%;
}

.close {
    position: absolute;
    right: 20px;
    top: 20px;
    color: #a0aec0;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    background: rgba(255, 255, 255, 0.8);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.close:hover {
    color: #2d3748;
    background: white;
    transform: scale(1.1);
}

.modal h2 {
    text-align: center;
    color: #1a202c;
    margin-bottom: 32px;
    font-size: 24px;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.cancel-list {
    max-height: 400px;
    overflow-y: auto;
    padding-right: 5px;
}

.cancel-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    margin-bottom: 12px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
}

.cancel-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
}

.cancel-info {
    flex: 1;
}

.cancel-day {
    font-weight: 800;
    color: #667eea;
    font-size: var(--button-font-size);
}

.cancel-details {
    color: #718096;
    font-size: var(--small-font-size);
    margin-top: 4px;
    font-weight: 500;
}

.no-applications {
    text-align: center;
    color: #a0aec0;
    font-style: italic;
    padding: 60px 20px;
    font-size: var(--base-font-size);
    font-weight: 500;
}

.admin-form {
    margin-bottom: 24px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    margin-bottom: 20px;
}

.admin-action-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
}

/* stats-header ìŠ¤íƒ€ì¼ ìˆ˜ì • */
.stats-header {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 24px;
    flex-wrap: nowrap; /* ìš”ì†Œê°€ í•œ ì¤„ì— ìœ ì§€ë˜ë„ë¡ */
}

/* month-navigation ìŠ¤íƒ€ì¼ ìˆ˜ì • */
.month-navigation {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    padding: 10px 16px;
    border-radius: 12px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    width: auto;
    max-width: 100%;
}

.month-nav-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 10px;
    width: 40px; /* ë²„íŠ¼ í¬ê¸° ì¡°ì • */
    height: 40px;
    cursor: pointer;
    font-size: 14px; /* í°íŠ¸ í¬ê¸° ì¡°ì • */
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.month-nav-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.current-month {
    font-size: 16px; /* í°íŠ¸ í¬ê¸° ì¡°ì • */
    font-weight: 700;
    color: #2d3748;
    width: auto; /* ê³ ì • í­ ì œê±° */
    text-align: center;
    white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
}

.stats-content {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    padding: 24px;
    border-radius: 16px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
}

@media (max-width: 768px) {
    .stats-header {
        padding: 0 10px; /* ì¢Œìš° íŒ¨ë”© ì¶”ê°€ */
    }

    .month-navigation {
        gap: 8px; /* ëª¨ë°”ì¼ì—ì„œ ê°„ê²© ì¶•ì†Œ */
        padding: 8px 12px;
    }

    .month-nav-btn {
        width: 36px; /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ í¬ê¸° ì¶•ì†Œ */
        height: 36px;
        font-size: 12px;
    }

    .current-month {
        font-size: 14px; /* ëª¨ë°”ì¼ì—ì„œ í°íŠ¸ í¬ê¸° ì¶•ì†Œ */
    }
}

@media (max-width: 390px) {
    .month-navigation {
        gap: 6px; /* ë” ì‘ì€ í™”ë©´ì—ì„œ ê°„ê²© ì¶•ì†Œ */
        padding: 6px 10px;
    }

    .month-nav-btn {
        width: 32px;
        height: 32px;
        font-size: 11px;
    }

    .current-month {
        font-size: 13px;
    }
}

.stats-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 12px;
    margin-bottom: 24px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    padding: 20px;
    border-radius: 16px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-3px);
}

.stat-number {
    font-size: 28px;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 6px;
}

.stat-label {
    font-size: 13px;
    color: #718096;
    font-weight: 600;
}

.zone-stats {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}

.zone-stat-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    padding: 18px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: transform 0.3s ease;
}

.zone-stat-card:hover {
    transform: translateY(-2px);
}

.zone-stat-title {
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 12px;
    font-size: 16px;
}

.zone-stat-bar {
    background: rgba(226, 232, 240, 0.8);
    border-radius: 8px;
    height: 10px;
    margin-bottom: 8px;
    overflow: hidden;
    backdrop-filter: blur(5px);
}

.zone-stat-fill {
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 8px;
    height: 100%;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.zone-stat-text {
    font-size: var(--label-font-size);
    color: #718096;
    font-weight: 600;
}

.user-list {
    margin-top: 28px;
    padding: 24px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(15px);
    border-radius: 16px;
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
}

.user-list h3 {
    margin-bottom: 18px;
    color: #1a202c;
    font-size: 18px;
    font-weight: 700;
}

.user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px;
    margin-bottom: 10px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}

.user-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}

.user-name {
    font-weight: 600;
    color: #2d3748;
    font-size: 16px;
}

.version-info {
    text-align: center;
    font-size: 11px;
    color: rgba(255, 255, 255, 0.7);
    margin-top: 20px;
    font-weight: 500;
    padding: 0 20px;
}

.notice-button {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 52px;
    height: 52px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    font-size: 20px;
    z-index: 999;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.notice-button.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

.notice-button.inactive {
    background: rgba(255, 255, 255, 0.9);
    color: #718096;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.notice-button:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
}

.notice-badge {
    position: absolute;
    top: -2px;
    right: -2px;
    width: 14px;
    height: 14px;
    background: #e53e3e;
    border-radius: 50%;
    display: none;
    box-shadow: 0 2px 8px rgba(229, 62, 62, 0.4);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.notice-modal-content h2.important {
    color: #e53e3e;
}

.notice-modal-content h2.normal {
    color: #667eea;
}

.notice-date {
    font-size: 12px;
    color: #a0aec0;
    text-align: center;
    margin-top: 18px;
    font-weight: 500;
}

.important-notice-checkbox {
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(102, 126, 234, 0.1);
}

.important-notice-checkbox input[type="checkbox"] {
    width: auto;
    margin: 0;
    transform: scale(1.3);
    accent-color: #667eea;
}

.important-notice-checkbox label {
    font-size: 15px;
    color: #2d3748;
    cursor: pointer;
    margin: 0;
    font-weight: 600;
}

::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6b46c1 100%);
}

@media (max-width: 768px) {
    body {
        padding: 0;
        align-items: flex-start;
    }
    
    .container {
        border-radius: 0;
        min-height: 100vh;
    }
    
    h1 {
        font-size: 24px;
        padding: 35px 20px 25px;
    }
    
    .admin-actions {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .day-selection {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .modal-content {
        padding: 25px 20px 35px;
        border-radius: 20px 20px 0 0;
        max-height: 85vh;
    }
    
    .stats-summary {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .cancel-item {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
    }
    
    .cancel-item .btn {
        width: 100%;
        margin: 0;
    }
    
    .notice-button {
        top: 16px;
        right: 16px;
        width: 48px;
        height: 48px;
        font-size: 18px;
    }
    
    .action-buttons .btn {
        padding: 22px;
        font-size: 18px;
        font-weight: 700;
    }
}

@supports (padding: max(0px)) {
    .container {
        padding-top: max(20px, env(safe-area-inset-top));
    }
    
    .notice-button {
        top: max(20px, calc(env(safe-area-inset-top) + 10px));
        right: max(20px, calc(env(safe-area-inset-right) + 10px));
    }
}

@media (prefers-color-scheme: dark) {
    body {
        background: linear-gradient(145deg, #4c51bf 0%, #553c9a 50%, #4c51bf 100%);
    }
    
    .container {
        background: rgba(26, 32, 44, 0.95);
        color: #e2e8f0;
    }
    
    h1 {
        color: #e2e8f0;
    }
    
    input[type="text"], select, textarea, input[type="number"] {
        background: rgba(45, 55, 72, 0.8);
        border-color: rgba(102, 126, 234, 0.3);
        color: #e2e8f0;
    }
    
    .applicants-list {
        background: none;
    }
    
    .day-title {
        background: rgba(45, 55, 72, 0.8);
        color: #9f7aea;
    }
    
    .zone-applicants {
        background: rgba(45, 55, 72, 0.9);
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .zone-name {
        color: #e2e8f0;
    }
    
    .applicant-names {
        color: #cbd5e0;
    }
}

@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .btn::before {
        display: none;
    }
    
    .name-tag::before {
        display: none;
    }
}

@media (prefers-contrast: high) {
    .btn {
        border: 2px solid #2d3748;
    }
    
    .day-label, .zone-label {
        border: 2px solid #4a5568;
    }
    
    .day-option input[type="radio"]:checked + .day-label,
    .zone-option input[type="radio"]:checked + .zone-label {
        border: 2px solid #1a202c;
    }
}

@media (hover: none) and (pointer: coarse) {
    .btn:hover {
        transform: none;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .day-label:hover, .zone-label:hover {
        transform: none;
        box-shadow: none;
        background: rgba(255, 255, 255, 0.7);
    }
    
    .cancel-item:hover {
        transform: none;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    
    .stat-card:hover, .zone-stat-card:hover, .user-item:hover {
        transform: none;
    }
    
    .btn:active {
        transform: scale(0.97);
        transition: transform 0.1s ease;
    }
    
    .day-label:active, .zone-label:active {
        transform: scale(0.97);
        transition: transform 0.1s ease;
    }
}

@media (max-width: 390px) {
    .container {
        padding: 20px 16px;
    }
    
    h1 {
        font-size: 22px;
        padding: 30px 16px 20px;
    }
    
    .btn {
        font-size: 16px;
        padding: 20px;
    }
    
    .modal-content {
        padding: 20px 16px 30px;
    }
    
    .modal h2 {
        font-size: 20px;
    }
    
    .stats-summary {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .month-navigation {
        padding: 10px 16px;
        gap: 12px;
    }
    
    .current-month {
        font-size: 16px;
    }
}
/* í”Œë¡œíŒ… ë©”ë‰´ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
.floating-menu-container {
    position: fixed;
    bottom: 20px;
    right: 30px;
    z-index: 1000;
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
    gap: 0;
}

/* ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ */
.floating-menu-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
}

.floating-menu-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.6s;
}

.floating-menu-btn:hover::before {
    left: 100%;
}

.floating-menu-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
}

/* í–„ë²„ê±° ì•„ì´ì½˜ */
.hamburger-icon {
    width: 24px;
    height: 18px;
    position: relative;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.hamburger-line {
    position: absolute;
    left: 0;
    width: 100%;
    height: 3px;
    background: white;
    border-radius: 2px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.hamburger-line:nth-child(1) {
    top: 0;
}

.hamburger-line:nth-child(2) {
    top: 50%;
    transform: translateY(-50%);
}

.hamburger-line:nth-child(3) {
    bottom: 0;
}

/* ë©”ë‰´ ì—´ë¦° ìƒíƒœ */
.floating-menu-container.open .hamburger-icon {
    transform: rotate(90deg);
}

.floating-menu-container.open .hamburger-line:nth-child(1) {
    top: 50%;
    transform: translateY(-50%) rotate(45deg);
}

.floating-menu-container.open .hamburger-line:nth-child(2) {
    opacity: 0;
    transform: translateY(-50%) translateX(20px);
}

.floating-menu-container.open .hamburger-line:nth-child(3) {
    bottom: 50%;
    transform: translateY(50%) rotate(-45deg);
}

/* ì„œë¸Œ ë©”ë‰´ ë²„íŠ¼ë“¤ */
.sub-menu-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    opacity: 0;
    transform: scale(0);
    pointer-events: none;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    position: absolute;
}

/* ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
.dark-mode-btn {
    background: rgba(255, 255, 255, 0.95);
    color: #f59e0b;
    bottom: 5px;
    right: 5px;
}

.dark-mode-btn:hover {
    background: white;
    transform: scale(1.1);
    box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
}

/* í™ˆ ë²„íŠ¼ */
.home-btn {
    background: rgba(255, 255, 255, 0.95);
    color: #10b981;
    bottom: 5px;
    right: 5px;
}

.home-btn:hover {
    background: white;
    transform: scale(1.1);
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
}

/* ë©”ë‰´ ì—´ë¦° ìƒíƒœ - ì„œë¸Œ ë²„íŠ¼ë“¤ ì• ë‹ˆë©”ì´ì…˜ */
.floating-menu-container.open .sub-menu-btn {
    opacity: 1;
    pointer-events: auto;
}

/* ë‹¤í¬ëª¨ë“œ ë²„íŠ¼ (ìœ„ìª½ìœ¼ë¡œ) */
.floating-menu-container.open .dark-mode-btn {
    transform: translateY(-70px) translateX(0px) scale(1);
    transition-delay: 0.1s;
}

/* í™ˆ ë²„íŠ¼ (ì™¼ìª½ìœ¼ë¡œ) */
.floating-menu-container.open .home-btn {
    transform: translateY(0px) translateX(-70px) scale(1);
    transition-delay: 0.15s;
}

/* ë‹¤í¬ëª¨ë“œ ìƒíƒœ */
body.dark-mode {
    background: linear-gradient(145deg, #1a202c 0%, #2d3748 50%, #1a202c 100%);
}

body.dark-mode .container {
    background: rgba(26, 32, 44, 0.95);
    color: #e2e8f0;
}

body.dark-mode h1 {
    color: #e2e8f0;
}

body.dark-mode input[type="text"], 
body.dark-mode select, 
body.dark-mode textarea, 
body.dark-mode input[type="number"] {
    background: rgba(45, 55, 72, 0.8);
    border-color: rgba(102, 126, 234, 0.3);
    color: #e2e8f0;
}

body.dark-mode .day-title {
    background: rgba(45, 55, 72, 0.8);
    color: #9f7aea;
}

body.dark-mode .zone-applicants {
    background: rgba(45, 55, 72, 0.9);
    border-color: rgba(255, 255, 255, 0.1);
}

body.dark-mode .zone-name {
    color: #e2e8f0;
}

body.dark-mode .applicant-names {
    color: #cbd5e0;
}

body.dark-mode .day-label, 
body.dark-mode .zone-label {
    background: rgba(45, 55, 72, 0.7);
    color: #e2e8f0;
    border-color: rgba(102, 126, 234, 0.3);
}

body.dark-mode .stats-content,
body.dark-mode .user-list,
body.dark-mode .cancel-item,
body.dark-mode .user-item,
body.dark-mode .stat-card,
body.dark-mode .zone-stat-card {
    background: rgba(45, 55, 72, 0.9);
    border-color: rgba(255, 255, 255, 0.1);
    color: #e2e8f0;
}

body.dark-mode .modal-content {
    background: rgba(26, 32, 44, 0.95);
    color: #e2e8f0;
}

/* ë‹¤í¬ëª¨ë“œì—ì„œ ì•„ì´ì½˜ ë³€ê²½ */
body.dark-mode .dark-mode-btn {
    background: rgba(45, 55, 72, 0.95);
    color: #fbbf24;
}

body.dark-mode .dark-mode-btn:hover {
    background: rgba(55, 65, 81, 1);
    box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3);
}

body.dark-mode .home-btn {
    background: rgba(45, 55, 72, 0.95);
    color: #34d399;
}

body.dark-mode .home-btn:hover {
    background: rgba(55, 65, 81, 1);
    box-shadow: 0 8px 25px rgba(52, 211, 153, 0.3);
}

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .floating-menu-container {
        bottom: 15px;
        right: 20px;
        gap: 0;
    }
    
    .floating-menu-btn {
        width: 56px;
        height: 56px;
    }
    
    .sub-menu-btn {
        width: 46px;
        height: 46px;
        font-size: 18px;
    }
    
    .dark-mode-btn, .home-btn {
        bottom: 5px;
        right: 5px;
    }
    
    .floating-menu-container.open .dark-mode-btn {
        transform: translateY(-65px) translateX(0px) scale(1);
    }
    
    .floating-menu-container.open .home-btn {
        transform: translateY(0px) translateX(-65px) scale(1);
    }
    
    .hamburger-icon {
        width: 22px;
        height: 16px;
    }
    
    .hamburger-line {
        height: 2.5px;
    }
}

/* ì•ˆì „ ì˜ì—­ ì§€ì› */
@supports (padding: max(0px)) {
    .floating-menu-container {
        bottom: max(20px, calc(env(safe-area-inset-bottom) + 10px));
        right: max(30px, calc(env(safe-area-inset-right) + 20px));
    }
}

/* ì• ë‹ˆë©”ì´ì…˜ ê°ì†Œ ì„¤ì • */
@media (prefers-reduced-motion: reduce) {
    .floating-menu-btn,
    .sub-menu-btn,
    .hamburger-icon,
    .hamburger-line {
        transition-duration: 0.01ms !important;
        animation-duration: 0.01ms !important;
    }
}

/* ê³ ëŒ€ë¹„ ëª¨ë“œ ì§€ì› */
@media (prefers-contrast: high) {
    .floating-menu-btn,
    .sub-menu-btn {
        border: 3px solid #2d3748;
    }
    
    body.dark-mode .floating-menu-btn,
    body.dark-mode .sub-menu-btn {
        border: 3px solid #e2e8f0;
    }
}
.time-selection-container {
    display: none;
}

.time-selection-container.show {
    display: block;
    animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.time-selection {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-top: 16px;
}

.time-option {
    position: relative;
}

.time-option input[type="radio"] {
    display: none;
}

.time-label {
    display: block;
    padding: 20px 16px;
    border: none;
    border-radius: 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(102, 126, 234, 0.1);
    font-weight: 600;
    font-size: var(--label-font-size);
    position: relative;
    overflow: hidden;
}

.time-label::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.time-option input[type="radio"]:checked + .time-label {
    color: white;
    border-color: #667eea;
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
    transform: translateY(-2px);
}

.time-option input[type="radio"]:checked + .time-label::before {
    opacity: 1;
}

.time-label:active {
    transform: scale(0.98);
}

.time-label.disabled {
    background: #ff6b6b !important;
    color: white !important;
    border-color: #ff6b6b !important;
    cursor: not-allowed !important;
}

.time-capacity-info {
    font-size: var(--small-font-size);
    margin-top: 6px;
    color: #718096;
    font-weight: 500;
}
.time-slot-header {
    font-size: var(--small-font-size);
    color: #667eea;
    font-weight: 700;
    margin-bottom: 6px;
}

.time-option input[type="radio"]:checked + .time-label .time-capacity-info {
    color: rgba(255, 255, 255, 0.9);
}

@media (max-width: 768px) {
    .time-selection {
        grid-template-columns: 1fr;
        gap: 10px;
    }
}

body.dark-mode .time-label {
    background: rgba(45, 55, 72, 0.7);
    color: #e2e8f0;
    border-color: rgba(102, 126, 234, 0.3);
}
/* ì‹œê°„ëŒ€ ì„¤ì • ì»¨í…Œì´ë„ˆ */
.time-slot-settings {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 20px;
    margin: 16px 0;
    border: 1px solid rgba(102, 126, 234, 0.1);
    min-height: 60px;
    max-height: 300px;
    overflow-y: auto;
}

.time-slot-setting {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    transition: all 0.3s ease;
}

.time-slot-setting:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.time-slot-row {
    display: grid;
    grid-template-columns: 1fr 1fr auto auto;
    gap: 12px;
    align-items: center;
}

.time-input-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.time-input-label {
    font-size: var(--small-font-size);
    color: #667eea;
    font-weight: 600;
    margin: 0;
}

.time-picker-container {
    display: flex;
    gap: 8px;
    align-items: center;
}

.time-picker {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(102, 126, 234, 0.2);
    border-radius: 8px;
    padding: 8px 12px;
    font-size: var(--label-font-size);
}

.time-select {
    border: none;
    background: transparent;
    font-size: var(--label-font-size);
    font-weight: 600;
    color: #2d3748;
    cursor: pointer;
}

.time-select:focus {
    outline: none;
}

.capacity-input {
    width: 70px !important;
    padding: 12px !important;
    text-align: center;
    font-weight: 600;
}

.btn.remove-time {
    background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 14px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(252, 129, 129, 0.3);
    min-width: 60px;
}

.btn.remove-time:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(252, 129, 129, 0.4);
}

.btn.toggle-active {
    background: linear-gradient(135deg, #68d391 0%, #38a169 100%);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 14px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(104, 211, 145, 0.3);
    min-width: 60px;
}

.btn.toggle-active:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(104, 211, 145, 0.4);
}

.btn.toggle-active.inactive {
    background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
    box-shadow: 0 4px 12px rgba(160, 174, 192, 0.3);
}

.time-slot-controls {
    display: flex;
    justify-content: center;
    margin: 20px 0;
}

.zone-add-controls {
    display: flex;
    justify-content: center;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid rgba(102, 126, 234, 0.1);
}

.empty-time-slots {
    text-align: center;
    color: #a0aec0;
    font-style: italic;
    padding: 30px 20px;
    font-size: 14px;
}

/* ë‹¤í¬ëª¨ë“œ ì§€ì› */
body.dark-mode .time-slot-settings,
body.dark-mode .time-slot-setting {
    background: rgba(45, 55, 72, 0.9);
    border-color: rgba(255, 255, 255, 0.1);
}

body.dark-mode .time-picker {
    background: rgba(55, 65, 81, 0.9);
    border-color: rgba(102, 126, 234, 0.3);
}

body.dark-mode .time-select {
    color: #e2e8f0;
}

body.dark-mode .time-input-label {
    color: #9f7aea;
}

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .time-slot-row {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .time-input-group {
        grid-column: 1;
    }
    
    .capacity-input {
        width: 100% !important;
    }
    
    .time-picker-container {
        justify-content: space-between;
    }
    
    .btn.remove-time,
    .btn.toggle-active {
        width: 100%;
        margin-top: 8px;
    }
}
.warning {
    font-size: 12px;
    color: #e53e3e;
    margin-top: 4px;
    font-weight: 500;
}
/* ê¸€ì í¬ê¸° ì¡°ì • ë²„íŠ¼ */
.font-size-btn {
    background: rgba(255, 255, 255, 0.95);
    color: #667eea;
    bottom: 5px;
    right: 5px;
    font-weight: bold;
    font-size: 18px;
}

.font-size-btn:hover {
    background: white;
    transform: scale(1.1);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

/* ê¸€ì í¬ê¸° ìŠ¬ë¼ì´ë” ì»¨í…Œì´ë„ˆ */
.font-size-slider-container {
    position: absolute;
    bottom: 70px;
    right: 10px;
    width: 200px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 15px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.3);
    opacity: 0;
    transform: translateY(20px) scale(0.9);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
    z-index: 1001;
}

.font-size-slider-container.show {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
}

/* ìŠ¬ë¼ì´ë” í—¤ë” */
.slider-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-weight: 600;
    color: #2d3748;
}

.close-slider {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #a0aec0;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.close-slider:hover {
    background: rgba(0, 0, 0, 0.05);
    color: #4a5568;
}

/* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
#fontSizeRange {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: #e2e8f0;
    outline: none;
    appearance: none;  
    -webkit-appearance: none;
}

#fontSizeRange::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #667eea;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
}

#fontSizeRange::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #667eea;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
}

.slider-value {
    text-align: center;
    margin-top: 8px;
    font-size: 13px;
    color: #718096;
    font-weight: 600;
}

/* ë‹¤í¬ëª¨ë“œì—ì„œì˜ ìŠ¤íƒ€ì¼ */
body.dark-mode .font-size-btn {
    background: rgba(45, 55, 72, 0.95);
    color: #9f7aea;
}

body.dark-mode .font-size-btn:hover {
    background: rgba(55, 65, 81, 1);
    box-shadow: 0 8px 25px rgba(159, 122, 234, 0.3);
}

body.dark-mode .font-size-slider-container {
    background: rgba(45, 55, 72, 0.95);
    border-color: rgba(255, 255, 255, 0.1);
    color: #e2e8f0;
}

body.dark-mode .slider-header {
    color: #e2e8f0;
}

body.dark-mode .close-slider {
    color: #cbd5e0;
}

body.dark-mode .close-slider:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #e2e8f0;
}

body.dark-mode #fontSizeRange {
    background: #4a5568;
}

/* í”Œë¡œíŒ… ë©”ë‰´ ì—´ë¦° ìƒíƒœì—ì„œì˜ ê¸€ì í¬ê¸° ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì • */
.floating-menu-container.open .font-size-btn {
    transform: translateY(-140px) translateX(0px) scale(1);
    transition-delay: 0.05s;
}

.floating-menu-container.open .dark-mode-btn {
    transform: translateY(-70px) translateX(0px) scale(1);
    transition-delay: 0.1s;
}

.floating-menu-container.open .home-btn {
    transform: translateY(0px) translateX(-70px) scale(1);
    transition-delay: 0.15s;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .font-size-slider-container {
        width: 180px;
        right: 5px;
    }
    
    .floating-menu-container.open .font-size-btn {
        transform: translateY(-130px) translateX(0px) scale(1);
    }
    
    .floating-menu-container.open .dark-mode-btn {
        transform: translateY(-65px) translateX(0px) scale(1);
    }
    
    .floating-menu-container.open .home-btn {
        transform: translateY(0px) translateX(-65px) scale(1);
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
        <div class="login-page" id="loginPage">
            <h1>ë¶ˆê´‘ì„œë¶€íšŒì¤‘<br>ì „ì‹œëŒ€ ë´‰ì‚¬ ì‹ ì²­</h1>

            <div class="login-form">
                <div class="form-group">
                    <label for="loginName">ì´ë¦„</label>
                    <input type="text" id="loginName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <button type="button" class="btn" onclick="login()">í™•ì¸</button>
            </div>
        </div>

        <!-- ì¼ë°˜ ì‚¬ìš©ì ë©”ì¸ í˜ì´ì§€ -->
        <div class="main-page" id="mainPage">
            <h1>ë¶ˆê´‘ì„œë¶€íšŒì¤‘<br>ì „ì‹œëŒ€ ë´‰ì‚¬ ì‹ ì²­</h1>

            <div class="user-info" id="userInfo"></div>

            <div class="action-buttons">
                <button type="button" class="btn" onclick="openRegistrationModal()">ì „ì‹œëŒ€ ë´‰ì‚¬ ì‹ ì²­</button>
                <button type="button" class="btn secondary" onclick="openCancelModal()">ì‹ ì²­ ì·¨ì†Œ</button>
            </div>
        </div>

        <!-- ê´€ë¦¬ì í˜ì´ì§€ -->
        <div class="admin-page" id="adminPage">
            <h1>ê´€ë¦¬ì ëª¨ë“œ</h1>

            <div class="admin-info">ê´€ë¦¬ìë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</div>

            <div class="admin-actions">
                <button type="button" class="btn admin" onclick="openUserManagementModal()">ì‚¬ìš©ì ê´€ë¦¬</button>
                <button type="button" class="btn admin" onclick="openZoneManagementModal()">êµ¬ì—­ ê´€ë¦¬</button>
                <button type="button" class="btn admin" onclick="openNoticeManagementModal()">ê³µì§€ì‚¬í•­ ê´€ë¦¬</button>
                <button type="button" class="btn secondary" onclick="openStatsModal()">ë°ì´í„° í†µê³„</button>
            </div>
        </div>

        <!-- ì‹ ì²­ í˜„í™© -->
        <div class="applicants-list">
            <h3>ì‹ ì²­ í˜„í™©</h3>
            <div id="applicantsList"></div>
        </div>
        <div class="version-info">v2.1</div>
    </div>
    <!-- ê³ ì • ê³µì§€ ë²„íŠ¼ -->
<button id="noticeButton" class="notice-button inactive" onclick="handleNoticeButtonClick()" style="display: none;">
    ğŸ“¢
    <div id="noticeBadge" class="notice-badge"></div>
</button>

    <!-- ì‹ ì²­ ëª¨ë‹¬ -->
    <div id="registrationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRegistrationModal()">&times;</span>
            <h2>ì „ì‹œëŒ€ ë´‰ì‚¬ ì‹ ì²­</h2>

            <form id="registrationForm">
                <div class="form-group">
                    <label>ìš”ì¼ ì„ íƒ</label>
                    <div class="day-selection">
                        <div class="day-option">
                            <input type="radio" id="monday" name="day" value="ì›”ìš”ì¼">
                            <label for="monday" class="day-label" data-day="ì›”ìš”ì¼">
                                ì›”ìš”ì¼
                                <div class="date-info" id="monday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="tuesday" name="day" value="í™”ìš”ì¼">
                            <label for="tuesday" class="day-label" data-day="í™”ìš”ì¼">
                                í™”ìš”ì¼
                                <div class="date-info" id="tuesday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="wednesday" name="day" value="ìˆ˜ìš”ì¼">
                            <label for="wednesday" class="day-label" data-day="ìˆ˜ìš”ì¼">
                                ìˆ˜ìš”ì¼
                                <div class="date-info" id="wednesday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="thursday" name="day" value="ëª©ìš”ì¼">
                            <label for="thursday" class="day-label" data-day="ëª©ìš”ì¼">
                                ëª©ìš”ì¼
                                <div class="date-info" id="thursday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="friday" name="day" value="ê¸ˆìš”ì¼">
                            <label for="friday" class="day-label" data-day="ê¸ˆìš”ì¼">
                                ê¸ˆìš”ì¼
                                <div class="date-info" id="friday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="saturday" name="day" value="í† ìš”ì¼">
                            <label for="saturday" class="day-label" data-day="í† ìš”ì¼">
                                í† ìš”ì¼
                                <div class="date-info" id="saturday-date"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group zone-selection-container" id="zoneSelectionContainer">
                    <label>êµ¬ì—­ ì„ íƒ</label>
                    <div class="zone-selection" id="zoneSelection">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
                <div class="form-group time-selection-container" id="timeSelectionContainer">
                    <label>ì‹œê°„ ì„ íƒ</label>
                    <div class="time-selection" id="timeSelection">
                         <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <button type="submit" class="btn">ì‹ ì²­í•˜ê¸°</button>
            </form>
        </div>
    </div>

    <!-- ì‹ ì²­ ì·¨ì†Œ ëª¨ë‹¬ -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCancelModal()">&times;</span>
            <h2>ì‹ ì²­ ì·¨ì†Œ</h2>

            <div id="cancelList" class="cancel-list">
                <!-- ì‹ ì²­ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminModal()">&times;</span>
            <h2>ì‹ ì²­ ê´€ë¦¬</h2>

            <div class="admin-form">
                <div class="form-group">
                    <label for="adminUserSelect">ì‚¬ìš©ì ì„ íƒ</label>
                    <select id="adminUserSelect">
                        <option value="">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- ì‚¬ìš©ì ëª©ë¡ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="adminAction">ì‘ì—…</label>
                    <select id="adminAction">
                        <option value="">ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="assign">ì„ì˜ ë°°ì •</option>
                        <option value="cancel">ì„ì˜ ì·¨ì†Œ</option>
                    </select>
                </div>

                <div class="form-group" id="adminDayZoneRow" style="display: none;">
                    <label>ìš”ì¼ ì„ íƒ</label>
                    <div class="day-selection">
                        <div class="day-option">
                            <input type="radio" id="admin-monday" name="admin-day" value="ì›”ìš”ì¼">
                            <label for="admin-monday" class="day-label" data-day="ì›”ìš”ì¼">
                                ì›”ìš”ì¼
                                <div class="date-info" id="admin-monday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-tuesday" name="admin-day" value="í™”ìš”ì¼">
                            <label for="admin-tuesday" class="day-label" data-day="í™”ìš”ì¼">
                                í™”ìš”ì¼
                                <div class="date-info" id="admin-tuesday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-wednesday" name="admin-day" value="ìˆ˜ìš”ì¼">
                            <label for="admin-wednesday" class="day-label" data-day="ìˆ˜ìš”ì¼">
                                ìˆ˜ìš”ì¼
                                <div class="date-info" id="admin-wednesday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-thursday" name="admin-day" value="ëª©ìš”ì¼">
                            <label for="admin-thursday" class="day-label" data-day="ëª©ìš”ì¼">
                                ëª©ìš”ì¼
                                <div class="date-info" id="admin-thursday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-friday" name="admin-day" value="ê¸ˆìš”ì¼">
                            <label for="admin-friday" class="day-label" data-day="ê¸ˆìš”ì¼">
                                ê¸ˆìš”ì¼
                                <div class="date-info" id="admin-friday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-saturday" name="admin-day" value="í† ìš”ì¼">
                            <label for="admin-saturday" class="day-label" data-day="í† ìš”ì¼">
                                í† ìš”ì¼
                                <div class="date-info" id="admin-saturday-date"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group zone-selection-container" id="adminZoneSelectionContainer" style="display: none;">
                    <label>êµ¬ì—­ ì„ íƒ</label>
                    <div class="zone-selection" id="adminZoneSelection">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
                <div class="form-group time-selection-container" id="adminTimeSelectionContainer" style="display: none;">
                    <label>ì‹œê°„ ì„ íƒ</label>
                    <div class="time-selection" id="adminTimeSelection">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <div id="adminCancelList" style="display: none;">
                    <h4>ì·¨ì†Œí•  ì‹ ì²­ ì„ íƒ</h4>
                    <div id="adminCancelOptions"></div>
                </div>

                <div class="admin-action-buttons">
                    <button type="button" class="btn success small" onclick="executeAdminAction()">ì‹¤í–‰</button>
                    <button type="button" class="btn secondary small" onclick="resetAdminForm()">ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="userManagementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserManagementModal()">&times;</span>
            <h2>ì‚¬ìš©ì ê´€ë¦¬</h2>

            <div class="form-group">
                <label for="newUserName">ìƒˆ ì‚¬ìš©ì ì¶”ê°€</label>
                <input type="text" id="newUserName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                <button type="button" class="btn success small" onclick="addNewUser()" style="margin-top: 10px;">ì¶”ê°€</button>
            </div>

            <div class="user-list">
                <h3>ë“±ë¡ëœ ì‚¬ìš©ì</h3>
                <div id="userManagementList"></div>
            </div>
        </div>
    </div>

    <!-- êµ¬ì—­ ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="zoneManagementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeZoneManagementModal()">&times;</span>
            <h2>êµ¬ì—­ ê´€ë¦¬</h2>

<div class="form-group">
    <label for="newZoneName">ìƒˆ êµ¬ì—­ ì¶”ê°€</label>
    <input type="text" id="newZoneName" placeholder="êµ¬ì—­ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
</div>
<div class="form-group">
    <label>ì‹œê°„ëŒ€ ì„¤ì •</label>
    <div id="timeSlotSettings" class="time-slot-settings">
        <!-- ë™ì ìœ¼ë¡œ ì‹œê°„ëŒ€ ì„¤ì • UI ìƒì„± -->
    </div>
    <div class="time-slot-controls">
        <button type="button" class="btn secondary small" onclick="addTimeSlot()">ì‹œê°„ëŒ€ ì¶”ê°€</button>
    </div>
</div>

<div class="zone-add-controls">
    <button type="button" class="btn success" onclick="addNewZone()">êµ¬ì—­ ì¶”ê°€</button>
</div>

            <div class="user-list">
                <h3>ë“±ë¡ëœ êµ¬ì—­</h3>
                <div id="zoneManagementList"></div>
            </div>
        </div>
    </div>

    <!-- ë°ì´í„° í†µê³„ ëª¨ë‹¬ -->
    <div id="statsModal" class="modal">
    <div class="modal-content large">
        <span class="close" onclick="closeStatsModal()">&times;</span>
        <h2 style="text-align:center;"> <span id="currentMonth"></span> </h2>
        <div class="stats-header">
            <div class="month-navigation">
                <button class="month-nav-btn" onclick="changeMonth(-1)">â€¹</button>
                <div class="current-month" id="currentMonth"></div>
                <button class="month-nav-btn" onclick="changeMonth(1)">â€º</button>
            </div>
        </div>
        <div class="stats-content">
            <div class="stats-buttons" style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px;">
                <button class="btn" onclick="displayZoneStats()">êµ¬ì—­ë³„ í†µê³„</button>
                <button class="btn" onclick="displayUserStats()">ê°œì¸ë³„ í†µê³„</button>
            </div>
            <div id="statsDisplayArea" style="overflow-y: auto; max-height: 400px;"></div>
        </div>
    </div>
</div>
    <!-- ê³µì§€ì‚¬í•­ ê´€ë¦¬ ëª¨ë‹¬ -->
<div id="noticeManagementModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeNoticeManagementModal()">&times;</span>
        <h2>ê³µì§€ì‚¬í•­ ê´€ë¦¬</h2>

        <div class="form-group">
            <label for="noticeContent">ê³µì§€ ë‚´ìš©</label>
            <textarea id="noticeContent" rows="5" placeholder="ê³µì§€ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." style="width: 100%; padding: 15px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 16px; resize: vertical; min-height: 120px;"></textarea>
        </div>

        <div class="important-notice-checkbox">
            <input type="checkbox" id="isImportantNotice">
            <label for="isImportantNotice">ì¤‘ìš” ê³µì§€ (ë¡œê·¸ì¸ ì‹œ ìë™ í‘œì‹œ)</label>
        </div>

        <div style="text-align: right; margin-bottom: 20px; color: #999; font-size: 14px;">
            ê¸€ììˆ˜: <span id="noticeCharCount">0</span>/300
        </div>

        <div class="admin-action-buttons">
            <button type="button" class="btn success small" onclick="saveNotice()">ê³µì§€ ì €ì¥</button>
            <button type="button" class="btn danger small" onclick="deleteNotice()">ê³µì§€ ì‚­ì œ</button>
            <button type="button" class="btn secondary small" onclick="cancelNoticeEdit()">ì·¨ì†Œ</button>
        </div>
    </div>
</div>
<!-- ê³µì§€ì‚¬í•­ í™•ì¸ ëª¨ë‹¬ -->
<div id="noticeViewModal" class="modal">
    <div class="modal-content notice-modal-content">
        <span class="close" onclick="closeNoticeViewModal()">&times;</span>
        <h2 id="noticeViewTitle">ğŸ“¢ ê³µì§€ì‚¬í•­</h2>
        
        <div id="noticeViewContent" style="margin: 20px 0; line-height: 1.6; font-size: var(--base-font-size);">
            <!-- ê³µì§€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
        
        <div id="noticeViewDate" class="notice-date">
            <!-- ë“±ë¡ ë‚ ì§œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button type="button" class="btn" onclick="closeNoticeViewModal()">í™•ì¸</button>
        </div>
    </div>
</div>

    <script>// ì‹ ì²­ì ë°ì´í„°ë¥¼ ì €ì¥í•  ê°ì²´
        const applicants = {};
        const days = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
        let zones = []; // ë™ì ìœ¼ë¡œ ë¡œë“œ
        let timeSlots = []; // ì‹œê°„ëŒ€ ë°°ì—´
        let currentUser = '';
        let isAdmin = false;
        let userApplications = [];
        let allApplications = [];
        let monthlyData = [];
        let currentStatsYear = new Date().getFullYear();
        let currentStatsMonth = new Date().getMonth() + 1;
        let allowedUsers = []; // ì„œë²„ì—ì„œ ë¡œë“œë  ë°°ì—´
        let usersLoaded = false; // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì—¬ë¶€ í™•ì¸
        // ê³µì§€ì‚¬í•­ ê´€ë ¨ ë³€ìˆ˜
        let currentNotice = null;
        let originalNoticeContent = '';

        // ì´ˆê¸° ë°ì´í„° êµ¬ì¡° ìƒì„±
        function initializeApplicants() {
            days.forEach(day => {
                applicants[day] = {};
                zones.forEach(zone => {
                    applicants[day][zone.name] = {};
                    zone.timeSlots.forEach(timeSlot => {
                        applicants[day][zone.name][timeSlot.time] = [];
                    });
                });
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.initializeApp = async function () {
    try {
        console.log('Initializing application...');
        setCurrentWeekDates();
        setAdminWeekDates();
        
        // êµ¬ì—­ì„ ë¨¼ì € ë¡œë“œí•˜ê³  ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
        await loadZonesFromFirestore();
        
        // ê·¸ ë‹¤ìŒ ì‚¬ìš©ì ë¡œë“œ
        await loadUsersFromFirestore();
        
        populateAdminUserSelect();
        loadDataFromFirestore();
        loadNoticeFromFirestore();

        document.getElementById('loginName').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        console.log('Application initialized successfully');
    } catch (error) {
        console.error('ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        alert('ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
};

        // Firestoreì—ì„œ êµ¬ì—­ ëª©ë¡ ë¡œë“œ
        async function loadZonesFromFirestore() {
            try {
                const { collection, getDocs } = window.firestoreFunctions;
                const zonesRef = collection(window.db, 'zones');
                const querySnapshot = await getDocs(zonesRef);
                zones = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    zones.push({
                        id: doc.id,
                        name: data.name,
                        maxCapacity: data.maxCapacity || 4,
                        timeSlots: data.timeSlots || [
                            { time: 'ì˜¤ì „ 9:00-12:00', maxCapacity: data.maxCapacity || 4, isActive: true },
                            { time: 'ì˜¤í›„ 1:00-4:00', maxCapacity: data.maxCapacity || 4, isActive: true }
                        ]
                    });
                });
                console.log('Loaded zones from Firestore:', zones);
                initializeApplicants(); // zones ë¡œë“œ í›„ applicants ì´ˆê¸°í™”
                updateZoneUI(); // UI ì—…ë°ì´íŠ¸
                updateDisplay(); // ì‹ ì²­ í˜„í™© ì—…ë°ì´íŠ¸
            } catch (error) {
                console.error('êµ¬ì—­ ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('êµ¬ì—­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // êµ¬ì—­ UI ë™ì  ì—…ë°ì´íŠ¸ (ëª¨ë‹¬ ë“±)
        function updateZoneUI() {
            const zoneSelection = document.getElementById('zoneSelection');
            if (zoneSelection) {
                zoneSelection.innerHTML = '';
                zones.forEach((zone, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'zone-option';
                    const totalCapacity = zone.timeSlots.reduce((sum, slot) => sum + (slot.isActive ? slot.maxCapacity : 0), 0);
                    const currentTotal = getCurrentZoneTotal(zone.name);
                    optionDiv.innerHTML = `
                        <input type="radio" id="zone${index}" name="zone" value="${zone.name}">
                        <label for="zone${index}" class="zone-label" data-zone="${zone.name}">
                            ${zone.name}
                        </label>
                    `;
                    zoneSelection.appendChild(optionDiv);
                });
            }

            const adminZoneSelection = document.getElementById('adminZoneSelection');
            if (adminZoneSelection) {
                adminZoneSelection.innerHTML = '';
                zones.forEach((zone, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'zone-option';
                    optionDiv.innerHTML = `
                            <input type="radio" id="admin-zone${index}" name="admin-zone" value="${zone.name}">
                            <label for="admin-zone${index}" class="zone-label" data-zone="${zone.name}">
                                ${zone.name}
                                <div class="capacity-info">0/${zone.maxCapacity}</div>
                            </label>
                        `;
                    adminZoneSelection.appendChild(optionDiv);
                });
            }
            console.log('Zone UI updated');
        }

function getCurrentZoneTotal(zoneName) {
    const selectedDay = document.querySelector('input[name="day"]:checked')?.value;
    if (!selectedDay || !applicants[selectedDay] || !applicants[selectedDay][zoneName]) {
        return 0;
    }
    
    let total = 0;
    Object.keys(applicants[selectedDay][zoneName]).forEach(timeSlot => {
        total += (applicants[selectedDay][zoneName][timeSlot] || []).length;
    });
    return total;
}
function openStatsModal() {
    const statsModal = document.getElementById('statsModal');
    if (!statsModal) {
        console.error('statsModal ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    statsModal.style.display = 'block';
    window.currentStatsYear = new Date().getFullYear();
    window.currentStatsMonth = new Date().getMonth() + 1;
    loadMonthlyStats();
}

function closeStatsModal() {
    const statsModal = document.getElementById('statsModal');
    if (statsModal) {
        statsModal.style.display = 'none';
    }
}
// ì‹œê°„ ì„ íƒ UI ì—…ë°ì´íŠ¸
function updateTimeSelection(selectedDay, selectedZone) {
    const timeSelection = document.getElementById('timeSelection');
    const timeContainer = document.getElementById('timeSelectionContainer');
    const zoneObj = zones.find(z => z.name === selectedZone);
    
    if (!zoneObj) {
        timeContainer.classList.remove('show');
        return;
    }
    
    timeSelection.innerHTML = '';
    let hasActiveSlots = false;
    
    zoneObj.timeSlots.forEach((timeSlot, index) => {
        if (!timeSlot.isActive) return; // ë¹„í™œì„±í™”ëœ ì‹œê°„ëŒ€ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ
        hasActiveSlots = true;
        
        const currentCount = applicants[selectedDay][selectedZone][timeSlot.time]?.length || 0;
        const isDisabled = currentCount >= timeSlot.maxCapacity;
        
        const optionDiv = document.createElement('div');
        optionDiv.className = 'time-option';
        
        const radioInput = document.createElement('input');
        radioInput.type = 'radio';
        radioInput.id = `time${index}`;
        radioInput.name = 'time';
        radioInput.value = timeSlot.time;
        radioInput.disabled = isDisabled;
        
        const label = document.createElement('label');
        label.htmlFor = `time${index}`;
        label.className = `time-label ${isDisabled ? 'disabled' : ''}`;
        label.dataset.time = timeSlot.time;
        
        // ê²¹ì¹¨ í™•ì¸
        let isOverlappingTime = false;
        userApplications.forEach(app => {
            if (app.day === selectedDay && isOverlapping(timeSlot.time, app.timeSlot)) {
                isOverlappingTime = true;
            }
        });
        
        if (isOverlappingTime) {
            radioInput.disabled = true;
            label.classList.add('disabled');
            label.innerHTML += '<div class="warning">ì´ë¯¸ ì‹ ì²­ëœ ì‹œê°„ëŒ€ì…ë‹ˆë‹¤</div>';
        }
        
        label.innerHTML = `
            ${formatTimeToAMPM(timeSlot.time)}
            <div class="time-capacity-info">${currentCount}/${timeSlot.maxCapacity}</div>
            ${label.innerHTML || ''}
        `;
        
        optionDiv.appendChild(radioInput);
        optionDiv.appendChild(label);
        timeSelection.appendChild(optionDiv);
    });
    
    // í™œì„± ì‹œê°„ëŒ€ê°€ ìˆìœ¼ë©´ ì»¨í…Œì´ë„ˆ í‘œì‹œ, ì—†ìœ¼ë©´ ìˆ¨ê¹€
    if (hasActiveSlots) {
        timeContainer.classList.add('show');
    } else {
        timeContainer.classList.remove('show');
        timeSelection.innerHTML = '<div class="empty-time-slots">ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œê°„ëŒ€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    }
}

// ì‹œê°„ëŒ€ ì¶”ê°€ í•¨ìˆ˜
function addTimeSlot() {
    const container = document.getElementById('timeSlotSettings');
    const index = container.children.length;
    
    const timeSlotDiv = document.createElement('div');
    timeSlotDiv.className = 'time-slot-setting';
    timeSlotDiv.innerHTML = `
        <div class="time-slot-row">
            <div class="time-input-group">
                <label class="time-input-label">ì‹œì‘ ì‹œê°„</label>
                <div class="time-picker-container">
                    <div class="time-picker">
                        <select class="time-select start-hour">
                            ${generateHourOptions()}
                        </select>
                        <span>:</span>
                        <select class="time-select start-minute">
                            ${generateMinuteOptions()}
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="time-input-group">
                <label class="time-input-label">ì¢…ë£Œ ì‹œê°„</label>
                <div class="time-picker-container">
                    <div class="time-picker">
                        <select class="time-select end-hour">
                            ${generateHourOptions()}
                        </select>
                        <span>:</span>
                        <select class="time-select end-minute">
                            ${generateMinuteOptions()}
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="time-input-group">
                <label class="time-input-label">ìµœëŒ€ ì¸ì›</label>
                <input type="number" class="capacity-input" value="4" min="1" max="20">
            </div>
            
            <div class="time-input-group">
                <button type="button" class="btn remove-time" onclick="removeTimeSlot(this)">ì‚­ì œ</button>
            </div>
        </div>
    `;
    
    container.appendChild(timeSlotDiv);
    
    // ê¸°ë³¸ê°’ ì„¤ì •
    const startHour = timeSlotDiv.querySelector('.start-hour');
    const endHour = timeSlotDiv.querySelector('.end-hour');
    if (index === 0) {
        startHour.value = '09';
        endHour.value = '12';
    } else {
        startHour.value = '13';
        endHour.value = '16';
    }
}

// ì‹œê°„ëŒ€ ì‚­ì œ í•¨ìˆ˜
function removeTimeSlot(button) {
    button.closest('.time-slot-setting').remove();
}

// ê¸€ì í¬ê¸° ìŠ¬ë¼ì´ë” í† ê¸€
function toggleFontSizeSlider() {
    const slider = document.getElementById('fontSizeSlider');
    const isShowing = slider.classList.contains('show');
    
    if (isShowing) {
        closeFontSizeSlider();
    } else {
        openFontSizeSlider();
    }
}

// ê¸€ì í¬ê¸° ìŠ¬ë¼ì´ë” ì—´ê¸°
function openFontSizeSlider() {
    const slider = document.getElementById('fontSizeSlider');
    slider.classList.add('show');
    
    // ì €ì¥ëœ ê¸€ì í¬ê¸° ê°’ìœ¼ë¡œ ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
    const savedSize = localStorage.getItem('fontSize');
    if (savedSize) {
        const fontSize = parseInt(savedSize.replace('px', ''));
        document.getElementById('fontSizeRange').value = fontSize;
        document.getElementById('fontSizeValue').textContent = savedSize;
    }
    
    // ìŠ¬ë¼ì´ë”ì— í¬ì»¤ìŠ¤
    document.getElementById('fontSizeRange').focus();
}

// ê¸€ì í¬ê¸° ìŠ¬ë¼ì´ë” ë‹«ê¸°
function closeFontSizeSlider() {
    const slider = document.getElementById('fontSizeSlider');
    slider.classList.remove('show');
}

// ê¸€ì í¬ê¸° ë³€ê²½ ì²˜ë¦¬
function changeFontSize(baseSize) {
  // ê¸°ë³¸ í¬ê¸° ë¹„ìœ¨ ê³„ì‚°
  const ratio = baseSize / 16;
  
  // CSS ë³€ìˆ˜ ì—…ë°ì´íŠ¸
  document.documentElement.style.setProperty('--base-font-size', `${baseSize}px`);
  document.documentElement.style.setProperty('--heading-font-size', `${26 * ratio}px`);
  document.documentElement.style.setProperty('--button-font-size', `${17 * ratio}px`);
  document.documentElement.style.setProperty('--label-font-size', `${15 * ratio}px`);
  document.documentElement.style.setProperty('--small-font-size', `${13 * ratio}px`);
  
  // ë³€ê²½ëœ ê°’ í‘œì‹œ
  document.getElementById('fontSizeValue').textContent = baseSize + 'px';
  
  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
  localStorage.setItem('fontSize', baseSize + 'px');
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ê¸€ì í¬ê¸° ì ìš©
function applySavedFontSize() {
  const savedSize = localStorage.getItem('fontSize');
  if (savedSize) {
    const sizeValue = parseInt(savedSize.replace('px', ''));
    changeFontSize(sizeValue);
    
    // ìŠ¬ë¼ì´ë” ê°’ë„ ì—…ë°ì´íŠ¸
    const slider = document.getElementById('fontSizeRange');
    if (slider) {
      slider.value = sizeValue;
    }
  }
}

// DOMì´ ë¡œë“œëœ í›„ ì‹¤í–‰
window.addEventListener('DOMContentLoaded', function() {
    // ì €ì¥ëœ ê¸€ì í¬ê¸° ì ìš©
    applySavedFontSize();
    
    // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
// ê¸°ì¡´ ì½”ë“œì—ì„œ ì´ ë¶€ë¶„ì„ ì°¾ì•„ ìˆ˜ì •í•©ë‹ˆë‹¤
const fontSizeSlider = document.getElementById('fontSizeRange');
if (fontSizeSlider) {
  fontSizeSlider.addEventListener('input', function() {
    changeFontSize(parseInt(this.value));
  });
}
    
    // ì™¸ë¶€ í´ë¦­ ì‹œ ìŠ¬ë¼ì´ë” ë‹«ê¸°
    document.addEventListener('click', function(event) {
        const slider = document.getElementById('fontSizeSlider');
        const fontBtn = document.querySelector('.font-size-btn');
        
        if (slider.classList.contains('show') && 
            !slider.contains(event.target) && 
            !fontBtn.contains(event.target)) {
            closeFontSizeSlider();
        }
    });
    
    // ESC í‚¤ë¡œ ìŠ¬ë¼ì´ë” ë‹«ê¸°
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const slider = document.getElementById('fontSizeSlider');
            if (slider.classList.contains('show')) {
                closeFontSizeSlider();
            }
        }
    });
});

// ë‹¤í¬ëª¨ë“œì—ì„œì˜ ê¸€ì í¬ê¸° ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
function updateFontSizeButtonColor() {
    const fontSizeBtn = document.querySelector('.font-size-btn');
    if (document.body.classList.contains('dark-mode')) {
        fontSizeBtn.style.background = 'rgba(45, 55, 72, 0.95)';
        fontSizeBtn.style.color = '#9f7aea';
    } else {
        fontSizeBtn.style.background = 'rgba(255, 255, 255, 0.95)';
        fontSizeBtn.style.color = '#667eea';
    }
}


function updateAdminTimeSelection(selectedDay, selectedZone) {
    const timeSelection = document.getElementById('adminTimeSelection');
    const zoneObj = zones.find(z => z.name === selectedZone);
    
    if (!zoneObj) return;
    
    timeSelection.innerHTML = '';
    
    zoneObj.timeSlots.forEach((timeSlot, index) => {
        if (!timeSlot.isActive) return;
        
        const currentCount = applicants[selectedDay][selectedZone][timeSlot.time]?.length || 0;
        
        const optionDiv = document.createElement('div');
        optionDiv.className = 'time-option';
        
        const radioInput = document.createElement('input');
        radioInput.type = 'radio';
        radioInput.id = `admin-time${index}`;
        radioInput.name = 'admin-time';
        radioInput.value = timeSlot.time;
        
        const label = document.createElement('label');
        label.htmlFor = `admin-time${index}`;
        label.className = 'time-label';
        label.dataset.time = timeSlot.time;
        
        label.innerHTML = `
            ${formatTimeToAMPM(timeSlot.time)}
            <div class="time-capacity-info">${currentCount}/${timeSlot.maxCapacity}</div>
        `;
        
        optionDiv.appendChild(radioInput);
        optionDiv.appendChild(label);
        timeSelection.appendChild(optionDiv);
    });
}

        // Firestoreì—ì„œ ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
        async function loadUsersFromFirestore() {
            if (usersLoaded) {
                console.log('Users already loaded, using cache');
                return;
            }

            try {
                console.log('Loading users from Firestore...');
                const { collection, getDocs } = window.firestoreFunctions;
                const usersRef = collection(window.db, 'users');
                const querySnapshot = await getDocs(usersRef);
                allowedUsers = [];
                querySnapshot.forEach((doc) => {
                    allowedUsers.push(doc.data().name);
                });
                usersLoaded = true;
                console.log('Loaded users from Firestore:', allowedUsers);
            } catch (error) {
                console.error('ì‚¬ìš©ì ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        // 24ì‹œê°„ì œë¥¼ ì˜¤ì „/ì˜¤í›„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
function formatTimeToAMPM(timeStr) {
    // timeStrì€ "HH:MM-HH:MM" í˜•ì‹
    const [start, end] = timeStr.split('-');
    const convertToAMPM = (time) => {
        const [hours, minutes] = time.split(':');
        const hourNum = parseInt(hours, 10);
        if (hourNum === 0) {
            return `ì˜¤ì „ 12:${minutes}`;
        } else if (hourNum < 12) {
            return `ì˜¤ì „ ${hourNum}:${minutes}`;
        } else if (hourNum === 12) {
            return `ì˜¤í›„ 12:${minutes}`;
        } else {
            return `ì˜¤í›„ ${hourNum - 12}:${minutes}`;
        }
    };
    return `${convertToAMPM(start)}-${convertToAMPM(end)}`;
}

        function invalidateUsersCache() {
            usersLoaded = false;
            console.log('Users cache invalidated');
        }

        // Firestoreì—ì„œ ë°ì´í„° ë¡œë“œ
        async function loadDataFromFirestore() {
            try {
                console.log('Loading data from Firestore...');
                const { collection, onSnapshot, query, where } = window.firestoreFunctions;
                const applicantsRef = collection(window.db, 'applicants');
                const currentWeekDates = getCurrentWeekDates();
                const weekQuery = query(
                    applicantsRef,
                    where('actualDate', '>=', currentWeekDates.start),
                    where('actualDate', '<=', currentWeekDates.end)
                );

                onSnapshot(weekQuery, (querySnapshot) => {
                    console.log('Firestore snapshot received:', querySnapshot.size, 'documents');
                    initializeApplicants(); // applicants ê°ì²´ ì´ˆê¸°í™”

                    allApplications = [];
                    userApplications = [];

                    querySnapshot.forEach((docSnap) => {
                        const data = docSnap.data();
                        const day = docSnap.id.split('_')[1]; // ì˜ˆ: "2025-08-11_ì›”ìš”ì¼" -> "ì›”ìš”ì¼"
                        const zonesData = data.zones || {};

                        Object.keys(zonesData).forEach(zone => {
    if (applicants[day] && applicants[day][zone]) {
        const zoneTimeSlots = zonesData[zone];
        
        // ê¸°ì¡´ ì‹œê°„ëŒ€ êµ¬ì¡°ê°€ ì•„ë‹Œ ê²½ìš° ë³€í™˜
        if (Array.isArray(zoneTimeSlots)) {
            // êµ¬ë²„ì „ ë°ì´í„° ì²˜ë¦¬ (ì‹œê°„ëŒ€ ì—†ì´ ì €ì¥ëœ ë°ì´í„°)
            const zoneObj = zones.find(z => z.name === zone);
            if (zoneObj && zoneObj.timeSlots.length > 0) {
                applicants[day][zone][zoneObj.timeSlots[0].time] = zoneTimeSlots;
                zoneTimeSlots.forEach(name => {
                    allApplications.push({
                        id: docSnap.id,
                        name: name,
                        day: day,
                        zone: zone,
                        timeSlot: zoneObj.timeSlots[0].time,
                        actualDate: data.actualDate
                    });
                    if (name === currentUser) {
                        userApplications.push({
                            id: docSnap.id,
                            name: name,
                            day: day,
                            zone: zone,
                            timeSlot: zoneObj.timeSlots[0].time,
                            actualDate: data.actualDate
                        });
                    }
                });
            }
        } else {
            // ìƒˆë¡œìš´ ì‹œê°„ëŒ€ êµ¬ì¡° ì²˜ë¦¬
            Object.keys(zoneTimeSlots).forEach(timeSlot => {
                applicants[day][zone][timeSlot] = zoneTimeSlots[timeSlot];
                zoneTimeSlots[timeSlot].forEach(name => {
                    allApplications.push({
                        id: docSnap.id,
                        name: name,
                        day: day,
                        zone: zone,
                        timeSlot: timeSlot,
                        actualDate: data.actualDate
                    });
                    if (name === currentUser) {
                        userApplications.push({
                            id: docSnap.id,
                            name: name,
                            day: day,
                            zone: zone,
                            timeSlot: timeSlot,
                            actualDate: data.actualDate
                        });
                    }
                });
            });
        }
    }
});
                    });

                    console.log('All applications loaded:', allApplications);
                    updateDisplay();
                    if (document.getElementById('cancelModal').style.display === 'block') {
                        updateCancelList();
                    }
                    if (document.getElementById('statsModal').style.display === 'block') {
                        loadMonthlyStats();
                    }
                }, (error) => {
                    console.error('Firestore snapshot error:', error);
                    alert('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
            } catch (error) {
                console.error('Firebase ì—°ê²° ì˜¤ë¥˜:', error);
                alert('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Firestoreì— ë°ì´í„° ì €ì¥
                async function saveToFirestore(name, day, zone, timeSlot) {
                    try {
                        console.log(`Saving to Firestore: ${name}, ${day}, ${zone}, ${timeSlot}`);
                        const { collection, doc, setDoc, updateDoc, arrayUnion } = window.firestoreFunctions;
                        const actualDate = getActualDateForDay(day);
                        const docId = `${actualDate}_${day}`;
                        const applicantsRef = doc(window.db, 'applicants', docId);

                        const docSnap = await window.firestoreFunctions.getDoc(applicantsRef);
                        if (docSnap.exists()) {
                            await updateDoc(applicantsRef, {
                                [`zones.${zone}.${timeSlot}`]: arrayUnion(name),
                                timestamp: new Date()
                            });
                        } else {
                            await setDoc(applicantsRef, {
                                actualDate: actualDate,
                                zones: { [zone]: { [timeSlot]: [name] } },
                                timestamp: new Date()
                            });
                        }
                        console.log(`Document saved/updated with ID: ${docId}`);
                        return true;
                    } catch (error) {
                        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                        alert('ì‹ ì²­ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        return false;
                    }
                }

        // Firestoreì—ì„œ ë°ì´í„° ì‚­ì œ
        async function deleteFromFirestore(docId, application) {
            try {
                console.log('Deleting from Firestore:', docId, application);
                const { doc, updateDoc, arrayRemove } = window.firestoreFunctions;
                const applicantsRef = doc(window.db, 'applicants', docId);
                await updateDoc(applicantsRef, {
                    [`zones.${application.zone}.${application.timeSlot}`]: arrayRemove(application.name)
                });
                console.log('Application removed successfully');
                return true;
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‹ ì²­ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                return false;
            }
        }

        // Firestoreì— ì‚¬ìš©ì ì¶”ê°€
        async function addUserToFirestore(name) {
            try {
                const { collection, addDoc } = window.firestoreFunctions;
                const usersRef = collection(window.db, 'users');
                await addDoc(usersRef, { name: name });
                console.log('User added:', name);
                return true;
            } catch (error) {
                console.error('ì‚¬ìš©ì ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('ì‚¬ìš©ì ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return false;
            }
        }

        // Firestoreì—ì„œ ì‚¬ìš©ì ì‚­ì œ
        async function deleteUserFromFirestore(docId) {
            try {
                const { deleteDoc, doc } = window.firestoreFunctions;
                await deleteDoc(doc(window.db, 'users', docId));
                console.log('User deleted with ID:', docId);
                return true;
            } catch (error) {
                console.error('ì‚¬ìš©ì ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return false;
            }
        }

        // Firestoreì— êµ¬ì—­ ì¶”ê°€
async function addZoneToFirestore(name, timeSlots) {
    try {
        const { collection, addDoc } = window.firestoreFunctions;
        const zonesRef = collection(window.db, 'zones');
        await addDoc(zonesRef, { 
            name: name, 
            timeSlots: timeSlots,
            maxCapacity: timeSlots.reduce((sum, slot) => sum + slot.maxCapacity, 0) // í˜¸í™˜ì„±ì„ ìœ„í•´
        });
        console.log('Zone added:', name);
        return true;
    } catch (error) {
        console.error('êµ¬ì—­ ì¶”ê°€ ì˜¤ë¥˜:', error);
        alert('êµ¬ì—­ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        return false;
    }
}

        // Firestoreì—ì„œ êµ¬ì—­ ì‚­ì œ
        async function deleteZoneFromFirestore(docId) {
            try {
                const { deleteDoc, doc } = window.firestoreFunctions;
                await deleteDoc(doc(window.db, 'zones', docId));
                console.log('Zone deleted with ID:', docId);
                return true;
            } catch (error) {
                console.error('êµ¬ì—­ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('êµ¬ì—­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return false;
            }
        }

        // ë¡œê·¸ì¸ í•¨ìˆ˜
        async function login() {
            const name = document.getElementById('loginName').value.trim();
            if (!name) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (name === 'admin') {
                currentUser = 'admin';
                isAdmin = true;
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminPage').style.display = 'block';
                console.log('Admin logged in');
                document.getElementById('noticeButton').style.display = 'block';
                return;
            }

            const { collection, getDocs, query, where } = window.firestoreFunctions;
            const usersRef = collection(window.db, 'users');
            const q = query(usersRef, where("name", "==", name));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                alert('ë“±ë¡ë˜ì§€ ì•Šì€ ì „ë„ì¸ì…ë‹ˆë‹¤.');
                document.getElementById('loginName').value = '';
                return;
            }

            currentUser = name;
            isAdmin = false;
            document.getElementById('userInfo').textContent = `${currentUser}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            document.getElementById('noticeButton').style.display = 'block';
            filterUserApplications();
            updateCancelList();
            updateDisplay();
            console.log('User logged in:', currentUser);
            // ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ ì‹œ (ê¸°ì¡´ ì½”ë“œ ë‹¤ìŒì— ì¶”ê°€)
            currentUser = name;
            isAdmin = false;
            document.getElementById('userInfo').textContent = `${currentUser}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            filterUserApplications();
            updateCancelList();
            updateDisplay();

            // ê³µì§€ì‚¬í•­ ë¡œë“œ ì¶”ê°€
            loadNoticeFromFirestore();

            console.log('User logged in:', currentUser);
        }

        // ê´€ë¦¬ì ì‚¬ìš©ì ì„ íƒ ëª©ë¡ ì±„ìš°ê¸°
        async function populateAdminUserSelect() {
            const select = document.getElementById('adminUserSelect');
            if (!select) return;

            select.innerHTML = '<option value="">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';

            if (!usersLoaded) {
                await loadUsersFromFirestore();
            }

            allowedUsers.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                select.appendChild(option);
            });
            console.log('Admin user select populated from cache');
        }

        // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ë° í‘œì‹œ
        async function loadAndDisplayUsers() {
            const userManagementListEl = document.getElementById('userManagementList');
            userManagementListEl.innerHTML = '';

            const { collection, getDocs } = window.firestoreFunctions;
            const usersRef = collection(window.db, 'users');
            const querySnapshot = await getDocs(usersRef);

            const userCount = querySnapshot.size;
            const userListHeading = document.querySelector('#userManagementModal .user-list h3');
            userListHeading.textContent = `ë“±ë¡ëœ ì‚¬ìš©ì (ì´ ${userCount}ëª…)`;

            if (querySnapshot.empty) {
                userManagementListEl.innerHTML = '<p>ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            querySnapshot.forEach((docSnap) => {
                const userData = docSnap.data();
                const userName = userData.name;
                const docId = docSnap.id;

                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                        <div class="user-name">${userName}</div>
                        <button class="btn danger small" onclick="deleteUser('${docId}', '${userName}')">ì‚­ì œ</button>
                    `;
                userManagementListEl.appendChild(userItem);
            });
        }

        // ìƒˆ ì‚¬ìš©ì ì¶”ê°€
        async function addNewUser() {
            const name = document.getElementById('newUserName').value.trim();
            if (!name) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const { collection, getDocs, query, where } = window.firestoreFunctions;
            const usersRef = collection(window.db, 'users');
            const q = query(usersRef, where("name", "==", name));
            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                alert('ì´ë¯¸ ë“±ë¡ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.');
                return;
            }

            const added = await addUserToFirestore(name);
            if (added) {
                alert(`${name}ë‹˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                document.getElementById('newUserName').value = '';
                invalidateUsersCache();
                loadUsersFromFirestore();
                populateAdminUserSelect();
                loadAndDisplayUsers();
            }
        }

        // ì‚¬ìš©ì ì‚­ì œ
        async function deleteUser(docId, userName) {
            if (confirm(`${userName}ë‹˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const deleted = await deleteUserFromFirestore(docId);
                if (deleted) {
                    alert(`${userName}ë‹˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    invalidateUsersCache();
                    loadUsersFromFirestore();
                    populateAdminUserSelect();
                    loadAndDisplayUsers();
                }
            }
        }

        // êµ¬ì—­ ëª©ë¡ ë¡œë“œ ë° í‘œì‹œ
        async function loadAndDisplayZones() {
            const zoneManagementListEl = document.getElementById('zoneManagementList');
            zoneManagementListEl.innerHTML = '';

            const { collection, getDocs } = window.firestoreFunctions;
            const zonesRef = collection(window.db, 'zones');
            const querySnapshot = await getDocs(zonesRef);

            if (querySnapshot.empty) {
                zoneManagementListEl.innerHTML = '<p>ë“±ë¡ëœ êµ¬ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            querySnapshot.forEach((docSnap) => {
                const zoneData = docSnap.data();
                const zoneName = zoneData.name;
                const maxCapacity = zoneData.maxCapacity;
                const docId = docSnap.id;

                const zoneItem = document.createElement('div');
                zoneItem.className = 'user-item';
                zoneItem.innerHTML = `
                        <div class="user-name">${zoneName} (ìš©ëŸ‰: ${maxCapacity})</div>
                        <button class="btn danger small" onclick="deleteZone('${docId}', '${zoneName}')">ì‚­ì œ</button>
                    `;
                zoneManagementListEl.appendChild(zoneItem);
            });
        }

        // ìƒˆ êµ¬ì—­ ì¶”ê°€
// ìƒˆ êµ¬ì—­ ì¶”ê°€ (ìˆ˜ì •ëœ ë²„ì „)
async function addNewZone() {
    const name = document.getElementById('newZoneName').value.trim();
    const timeSlotSettings = document.querySelectorAll('.time-slot-setting');
    
    if (!name) {
        alert('êµ¬ì—­ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    if (timeSlotSettings.length === 0) {
        alert('ìµœì†Œ í•˜ë‚˜ì˜ ì‹œê°„ëŒ€ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ì‹œê°„ëŒ€ ë°ì´í„° ìˆ˜ì§‘
    const timeSlots = [];
    
    timeSlotSettings.forEach(setting => {
        const startHour = setting.querySelector('.start-hour').value;
        const startMinute = setting.querySelector('.start-minute').value;
        const endHour = setting.querySelector('.end-hour').value;
        const endMinute = setting.querySelector('.end-minute').value;
        const capacity = parseInt(setting.querySelector('.capacity-input').value);
        
        const timeText = `${startHour}:${startMinute}-${endHour}:${endMinute}`;
        
        if (capacity > 0) {
            timeSlots.push({
                time: timeText,
                maxCapacity: capacity,
                isActive: true
            });
        }
    });
    
    if (timeSlots.length === 0) {
        alert('ìœ íš¨í•œ ì‹œê°„ëŒ€ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ê¸°ì¡´ êµ¬ì—­ëª… ì¤‘ë³µ ê²€ì‚¬
    const existingZone = zones.find(zone => zone.name === name);
    if (existingZone) {
        alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” êµ¬ì—­ ì´ë¦„ì…ë‹ˆë‹¤.');
        return;
    }
    
    const added = await addZoneToFirestore(name, timeSlots);
    if (added) {
        alert(`${name} êµ¬ì—­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        document.getElementById('newZoneName').value = '';
        document.getElementById('timeSlotSettings').innerHTML = '';
        loadZonesFromFirestore();
        loadAndDisplayZones();
    }
}

        // êµ¬ì—­ ì‚­ì œ
        async function deleteZone(docId, zoneName) {
            if (confirm(`${zoneName} êµ¬ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const deleted = await deleteZoneFromFirestore(docId);
                if (deleted) {
                    alert(`${zoneName} êµ¬ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    loadZonesFromFirestore();
                    loadAndDisplayZones();
                }
            }
        }

        // ì‹ ì²­ ëª¨ë‹¬ ì—´ê¸°
        function openRegistrationModal() {
            document.getElementById('registrationModal').style.display = 'block';
            setCurrentWeekDates();
            updateZoneDisplayForModal();
            console.log('Registration modal opened');
        }

        // ì‹ ì²­ ëª¨ë‹¬ ë‹«ê¸°
        function closeRegistrationModal() {
            document.getElementById('registrationModal').style.display = 'none';
            document.getElementById('registrationForm').reset();
            document.getElementById('zoneSelectionContainer').classList.remove('show');
            document.getElementById('timeSelectionContainer').classList.remove('show');
            console.log('Registration modal closed');
        }

        // ì‹ ì²­ ì·¨ì†Œ ëª¨ë‹¬ ì—´ê¸°
        function openCancelModal() {
            document.getElementById('cancelModal').style.display = 'block';
            filterUserApplications();
            updateCancelList();
            console.log('Cancel modal opened');
        }

        // ì‹ ì²­ ì·¨ì†Œ ëª¨ë‹¬ ë‹«ê¸°
        function closeCancelModal() {
            document.getElementById('cancelModal').style.display = 'none';
            console.log('Cancel modal closed');
        }

        // ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°
        function openUserManagementModal() {
            document.getElementById('userManagementModal').style.display = 'block';
            loadAndDisplayUsers();
            populateAdminUserSelect();
            console.log('User management modal opened');
        }

        // ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
        function closeUserManagementModal() {
            document.getElementById('userManagementModal').style.display = 'none';
            console.log('User management modal closed');
        }

        // êµ¬ì—­ ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°
        function openZoneManagementModal() {
            document.getElementById('zoneManagementModal').style.display = 'block';
            loadAndDisplayZones();
            console.log('Zone management modal opened');
        }

        // êµ¬ì—­ ê´€ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
        function closeZoneManagementModal() {
            document.getElementById('zoneManagementModal').style.display = 'none';
            console.log('Zone management modal closed');
        }

function displayZoneStats() {
  const display = document.getElementById('statsDisplayArea');
  display.innerHTML = '';

  const zoneMap = new Map();
  // zones ë°°ì—´ì´ ìˆìœ¼ë©´ ë¯¸ë¦¬ ì±„ìš°ê³ , ì—†ìœ¼ë©´ ë°ì´í„°ì—ì„œ ë™ì  ìƒì„±
  if (Array.isArray(zones) && zones.length) {
    zones.forEach(z => zoneMap.set(z.name, new Map()));
  }
  monthlyData.forEach(({ name, zone }) => {
    if (!zoneMap.has(zone)) zoneMap.set(zone, new Map());
    const userMap = zoneMap.get(zone);
    userMap.set(name, (userMap.get(name) || 0) + 1);
  });

  const table = document.createElement('table');
  table.style.width = '100%';
  table.style.borderCollapse = 'collapse';

  const thead = document.createElement('thead');
  thead.innerHTML =
    '<tr>' +
      '<th style="border:1px solid #ddd;padding:8px;background:#f0f0f0;">êµ¬ì—­</th>' +
      '<th style="border:1px solid #ddd;padding:8px;background:#f0f0f0;">ìš”ì•½</th>' +
      '<th style="border:1px solid #ddd;padding:8px;background:#f0f0f0;">ì°¸ì—¬ì (íšŸìˆ˜)</th>' +
    '</tr>';
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  zoneMap.forEach((userMap, zone) => {
    const row = document.createElement('tr');

    const zoneCell = document.createElement('td');
    zoneCell.textContent = zone;
    zoneCell.style.border = '1px solid #ddd';
    zoneCell.style.padding = '8px';

    const summaryCell = document.createElement('td');
    const distinct = userMap.size; // ì°¸ì—¬ ì¸ì› ìˆ˜
    const total = Array.from(userMap.values()).reduce((a, b) => a + b, 0); // ì´ ì‹ ì²­ íšŸìˆ˜
    summaryCell.textContent = `${distinct}ëª… / ${total}íšŒ`;
    summaryCell.style.border = '1px solid #ddd';
    summaryCell.style.padding = '8px';

    const usersCell = document.createElement('td');
    usersCell.style.border = '1px solid #ddd';
    usersCell.style.padding = '8px';
    usersCell.innerHTML = userMap.size
      ? Array.from(userMap.entries()).map(([u, c]) => `${u} (${c}íšŒ)`).join('<br>')
      : 'ì°¸ì—¬ì ì—†ìŒ';

    row.appendChild(zoneCell);
    row.appendChild(summaryCell);
    row.appendChild(usersCell);
    tbody.appendChild(row);
  });

  table.appendChild(tbody);
  display.appendChild(table);
}



function displayUserStats() {
  const displayArea = document.getElementById('statsDisplayArea');
  displayArea.innerHTML = '';

  // {user: Map(zone -> count)}
  const userMap = new Map();

  monthlyData.forEach(({ name, zone }) => {
    if (!userMap.has(name)) userMap.set(name, new Map());
    const zmap = userMap.get(name);
    zmap.set(zone, (zmap.get(zone) || 0) + 1);
  });

  const table = document.createElement('table');
  table.style.width = '100%';
  table.style.borderCollapse = 'collapse';

  const thead = document.createElement('thead');
  thead.innerHTML =
    '<tr>' +
      '<th style="border:1px solid #ddd;padding:8px;background:#f0f0f0;">ê°œì¸</th>' +
      '<th style="border:1px solid #ddd;padding:8px;background:#f0f0f0;">êµ¬ì—­ (íšŸìˆ˜)</th>' +
    '</tr>';
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  userMap.forEach((zmap, user) => {
    const row = document.createElement('tr');

    const userCell = document.createElement('td');
    userCell.textContent = user;
    userCell.style.border = '1px solid #ddd';
    userCell.style.padding = '8px';

    const zonesCell = document.createElement('td');
    zonesCell.style.border = '1px solid #ddd';
    zonesCell.style.padding = '8px';
    zonesCell.innerHTML = zmap.size
      ? Array.from(zmap.entries()).map(([z, c]) => `${z} (${c}íšŒ)`).join('<br>')
      : 'ì°¸ì—¬ êµ¬ì—­ ì—†ìŒ';

    row.appendChild(userCell);
    row.appendChild(zonesCell);
    tbody.appendChild(row);
  });

  table.appendChild(tbody);
  displayArea.appendChild(table);
}



        // ë°ì´í„° í†µê³„ ëª¨ë‹¬ ë‹«ê¸°
        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
            console.log('Stats modal closed');
        }

        // ì›”ê°„ í†µê³„ ë¡œë“œ
async function loadMonthlyStats() {
  try {
    const { collection, getDocs, query, where } = window.firestoreFunctions;
    const applicantsRef = collection(window.db, 'applicants');

    // ì´ë²ˆ ë‹¬ 1ì¼~ë§ì¼
    const startDate = new Date(currentStatsYear, currentStatsMonth - 1, 1);
    const endDate   = new Date(currentStatsYear, currentStatsMonth, 0);
    const startDateStr = getLocalDateString(startDate);
    const endDateStr   = getLocalDateString(endDate);

    const monthQuery = query(
      applicantsRef,
      where('actualDate', '>=', startDateStr),
      where('actualDate', '<=', endDateStr)
    );

    const snap = await getDocs(monthQuery);

    // ì „ì—­ ë°°ì—´ ì¬ì‚¬ìš©(ì¤‘ìš”! constë¡œ ìƒˆë¡œ ë§Œë“¤ì§€ ë§ê¸°)
    monthlyData = [];

    // Firestore ë¬¸ì„œì—ì„œ ì´ë¦„/êµ¬ì—­ë§Œ ë½‘ì•„ì„œ Push
    snap.forEach(doc => {
      const data = doc.data();
      const zonesData = data.zones || {};
      Object.keys(zonesData).forEach(zone => {
        const timeSlots = zonesData[zone] || {};
        Object.values(timeSlots).forEach(applicantList => {
          (applicantList || []).forEach(name => {
            monthlyData.push({ name, zone }); // ì‹œê°„/ìš”ì¼ ë²„ë¦¼
          });
        });
      });
    });

    // ìƒë‹¨ ì›” í‘œì‹œ
    const monthEl = document.getElementById('currentMonth');
    if (monthEl) {
      monthEl.textContent = `${currentStatsYear}ë…„ ${currentStatsMonth}ì›”`;
    }

    // ê¸°ë³¸ íƒ­: êµ¬ì—­ë³„
    displayZoneStats();

    // ë°ì´í„° ì—†ì„ ë•Œ ë©”ì‹œì§€
    if (monthlyData.length === 0) {
      document.getElementById('statsDisplayArea').innerHTML =
        '<p style="text-align:center;color:#a0aec0;">í•´ë‹¹ ì›”ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
    }
  } catch (e) {
    console.error('í†µê³„ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', e);
    document.getElementById('statsDisplayArea').innerHTML =
      '<p style="text-align:center;color:#e53e3e;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</p>';
    alert(`í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e.message}`);
  }
}


        // ë¡œì»¬ ë‚ ì§œ ë¬¸ìì—´ ìƒì„± í•¨ìˆ˜
        function getLocalDateString(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }
        // ì‹œê°„ëŒ€ ê²¹ì¹¨ í™•ì¸ í•¨ìˆ˜ (ì™„ì „íˆ ìƒˆë¡œ ì¶”ê°€)
function isOverlapping(newTime, existingTime) {
    // ì‹œê°„ ë¬¸ìì—´ "HH:MM-HH:MM"ì„ ë¶„ ë‹¨ìœ„ë¡œ ë³€í™˜
    function timeToMinutes(timeStr) {
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours * 60 + minutes;
    }

    // ìƒˆ ì‹œê°„ëŒ€ì˜ ì‹œì‘/ì¢…ë£Œ ì‹œê°„
    const [newStart, newEnd] = newTime.split('-').map(timeToMinutes);
    
    // ê¸°ì¡´ ì‹œê°„ëŒ€ì˜ ì‹œì‘/ì¢…ë£Œ ì‹œê°„
    const [existStart, existEnd] = existingTime.split('-').map(timeToMinutes);
    
    // ê²¹ì¹¨ ì¡°ê±´: ìƒˆ ì‹œì‘ ì‹œê°„ì´ ê¸°ì¡´ ì¢…ë£Œ ì‹œê°„ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ê³ , ìƒˆ ì¢…ë£Œ ì‹œê°„ì´ ê¸°ì¡´ ì‹œì‘ ì‹œê°„ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ìŒ
    return newStart <= existEnd && newEnd >= existStart;
}

        // ì›” ë³€ê²½
 function changeMonth(direction) {
    currentStatsMonth += direction;
    if (currentStatsMonth > 12) {
        currentStatsMonth = 1;
        currentStatsYear += 1;
    } else if (currentStatsMonth < 1) {
        currentStatsMonth = 12;
        currentStatsYear -= 1;
    }
    loadMonthlyStats();
}

        // í˜„ì¬ ì£¼ì˜ ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
        function getCurrentWeekDates() {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const saturday = new Date(sunday);
            saturday.setDate(sunday.getDate() + 6);
            return {
                start: getLocalDateString(sunday),
                end: getLocalDateString(saturday)
            };
        }

        // íŠ¹ì • ìš”ì¼ì˜ ì‹¤ì œ ë‚ ì§œ ê³„ì‚°
        function getActualDateForDay(dayName) {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const dayMap = {
                'ì›”ìš”ì¼': 1, 'í™”ìš”ì¼': 2, 'ìˆ˜ìš”ì¼': 3, 'ëª©ìš”ì¼': 4,
                'ê¸ˆìš”ì¼': 5, 'í† ìš”ì¼': 6
            };
            const targetDate = new Date(sunday);
            targetDate.setDate(sunday.getDate() + dayMap[dayName]);
            return getLocalDateString(targetDate);
        }

        // í˜„ì¬ ì£¼ì˜ ê° ìš”ì¼ ë‚ ì§œ ì„¤ì •
        function setCurrentWeekDates() {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const dayElements = [
                { id: 'monday-date', offset: 1 },
                { id: 'tuesday-date', offset: 2 },
                { id: 'wednesday-date', offset: 3 },
                { id: 'thursday-date', offset: 4 },
                { id: 'friday-date', offset: 5 },
                { id: 'saturday-date', offset: 6 }
            ];
            dayElements.forEach(day => {
                const date = new Date(sunday);
                date.setDate(sunday.getDate() + day.offset);
                const dateString = `${date.getMonth() + 1}/${date.getDate()}`;
                const element = document.getElementById(day.id);
                if (element) {
                    element.textContent = dateString;
                }
            });
            console.log('Current week dates set');
        }

        // ê´€ë¦¬ì ìš”ì¼ ë‚ ì§œ ì„¤ì •
        function setAdminWeekDates() {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const dayElements = [
                { id: 'admin-monday-date', offset: 1 },
                { id: 'admin-tuesday-date', offset: 2 },
                { id: 'admin-wednesday-date', offset: 3 },
                { id: 'admin-thursday-date', offset: 4 },
                { id: 'admin-friday-date', offset: 5 },
                { id: 'admin-saturday-date', offset: 6 }
            ];
            dayElements.forEach(day => {
                const date = new Date(sunday);
                date.setDate(sunday.getDate() + day.offset);
                const dateString = `${date.getMonth() + 1}/${date.getDate()}`;
                const element = document.getElementById(day.id);
                if (element) {
                    element.textContent = dateString;
                }
            });
            console.log('Admin week dates set');
        }

        // ì‚¬ìš©ì ì‹ ì²­ í•„í„°ë§
        function filterUserApplications() {
            if (!currentUser || isAdmin) {
                userApplications = [];
                return;
            }
            userApplications = allApplications.filter(a => a.name === currentUser);
            console.log('Filtered user applications:', userApplications);
        }

        // ì‹ ì²­ ì·¨ì†Œ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateCancelList() {
            const cancelListEl = document.getElementById('cancelList');
            cancelListEl.innerHTML = '';

            if (userApplications.length === 0) {
                const noApplicationsDiv = document.createElement('div');
                noApplicationsDiv.className = 'no-applications';
                noApplicationsDiv.textContent = 'ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.';
                cancelListEl.appendChild(noApplicationsDiv);
                console.log('No user applications to display in cancel list');
                return;
            }

            userApplications.forEach(application => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'cancel-item';

                const infoDiv = document.createElement('div');
                infoDiv.className = 'cancel-info';

                const dayDiv = document.createElement('div');
                dayDiv.className = 'cancel-day';
                dayDiv.textContent = application.day;

                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'cancel-details';
                const dateParts = application.actualDate.split('-');
                const date = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                const dateString = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;
                detailsDiv.textContent = `${dateString} â€¢ ${application.zone} â€¢ ${application.timeSlot || 'ì‹œê°„ë¯¸ì§€ì •'}`;

                infoDiv.appendChild(dayDiv);
                infoDiv.appendChild(detailsDiv);

                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'btn danger';
                cancelBtn.textContent = 'ì·¨ì†Œ';
                cancelBtn.onclick = () => confirmCancelApplication(application);

                itemDiv.appendChild(infoDiv);
                itemDiv.appendChild(cancelBtn);
                cancelListEl.appendChild(itemDiv);
            });
            console.log('User cancel list updated with', userApplications.length, 'items');
        }

        // ì‹ ì²­ ì·¨ì†Œ í™•ì¸
        function confirmCancelApplication(application) {
            const dateParts = application.actualDate.split('-');
            const date = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
            const dateString = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;
            const confirmMessage = `${application.day}(${dateString}) ${application.zone} ì „ì‹œëŒ€ ë´‰ì‚¬ ì‹ ì²­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;

            if (confirm(confirmMessage)) {
                cancelApplication(application.id, application);
            }
        }

        // ì‹ ì²­ ì·¨ì†Œ ì‹¤í–‰
        async function cancelApplication(docId, application) {
            const deleted = await deleteFromFirestore(docId, application);
            if (deleted) {
                const dateParts = application.actualDate.split('-');
                const date = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                const dateString = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;
                alert(`${application.day}(${dateString}) ${application.zone} ì‹ ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                closeCancelModal();
            }
        }

        // ëª¨ë‹¬ì—ì„œ êµ¬ì—­ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateZoneDisplayForModal() {
            document.querySelectorAll('.zone-label').forEach(label => {
                label.style.background = '';
                label.style.color = '';
                label.style.borderColor = '';
                label.style.cursor = 'pointer';
                label.previousElementSibling.disabled = false;
            });
            console.log('Zone display reset for modal');
        }

        // íŠ¹ì • ìš”ì¼ì˜ êµ¬ì—­ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateZoneDisplay(selectedDay) {
            const zoneLabels = document.querySelectorAll('#zoneSelection .zone-label');
            zoneLabels.forEach(label => {
                const zoneName = label.dataset.zone;
                const zoneObj = zones.find(z => z.name === zoneName);
                const maxCapacity = zoneObj ? zoneObj.maxCapacity : 4;
                const currentCount = applicants[selectedDay][zoneName].length;
                const capacityInfo = label.querySelector('.capacity-info');
                const radioInput = label.previousElementSibling;

                capacityInfo.textContent = `${currentCount}/${maxCapacity}`;

                if (currentCount >= maxCapacity) {
                    label.style.background = '#ff6b6b';
                    label.style.color = 'white';
                    label.style.borderColor = '#ff6b6b';
                    label.style.cursor = 'not-allowed';
                    radioInput.disabled = true;
                } else {
                    if (!radioInput.checked) {
                        label.style.background = '';
                        label.style.color = '';
                        label.style.borderColor = '';
                    }
                    label.style.cursor = 'pointer';
                    radioInput.disabled = false;
                }
            });
            console.log('Zone display updated for day:', selectedDay);
        }
        function generateHourOptions() {
    let options = '';
    for (let i = 6; i <= 22; i++) {
        const hour = i.toString().padStart(2, '0');
        options += `<option value="${hour}">${hour}</option>`;
    }
    return options;
}

function generateMinuteOptions() {
    const minutes = ['00', '15', '30', '45'];
    let options = '';
    minutes.forEach(minute => {
        options += `<option value="${minute}">${minute}</option>`;
    });
    return options;
}



function removeTimeSlot(button) {
    if (confirm('ì´ ì‹œê°„ëŒ€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        button.closest('.time-slot-setting').remove();
    }
}

        // ì‹ ì²­ì ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            const applicantsListEl = document.getElementById('applicantsList');
            applicantsListEl.innerHTML = '';

            days.forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-section';

                const dayTitleDiv = document.createElement('div');
                dayTitleDiv.className = 'day-title';
                const dayDate = getDateForDay(day);
                dayTitleDiv.textContent = `${day} (${dayDate})`;
                dayDiv.appendChild(dayTitleDiv);

zones.forEach(zone => {
    const zoneTimeSlots = applicants[day][zone.name] || {};
    
    const zoneDiv = document.createElement('div');
    zoneDiv.className = 'zone-applicants';

    const zoneNameDiv = document.createElement('div');
    zoneNameDiv.className = 'zone-name';
    zoneNameDiv.textContent = zone.name;

    const timeSlotsDiv = document.createElement('div');
    timeSlotsDiv.className = 'time-slots-container';
    
    zone.timeSlots.forEach(slot => {
        if (slot.isActive) {
            const currentCount = (zoneTimeSlots[slot.time] || []).length;
            const timeSlotDiv = document.createElement('div');
            timeSlotDiv.className = 'time-slot-item';
            timeSlotDiv.style.marginBottom = '12px';
            
            const timeHeaderDiv = document.createElement('div');
            timeHeaderDiv.className = 'time-slot-header';
            timeHeaderDiv.style.color = '#667eea';
            timeHeaderDiv.style.fontWeight = '700';
            timeHeaderDiv.style.marginBottom = '6px';
            timeHeaderDiv.textContent = `${formatTimeToAMPM(slot.time)} (${currentCount}/${slot.maxCapacity})`;
            
            const namesDiv = document.createElement('div');
            if (currentCount > 0) {
                namesDiv.innerHTML = zoneTimeSlots[slot.time]
                    .map(name => `<span class="name-tag">${name}</span>`)
                    .join('');
            } else {
                namesDiv.innerHTML = '<span style="color: #a0aec0; font-style: italic;">ì‹ ì²­ì ì—†ìŒ</span>';
            }
            
            timeSlotDiv.appendChild(timeHeaderDiv);
            timeSlotDiv.appendChild(namesDiv);
            timeSlotsDiv.appendChild(timeSlotDiv);
        }
    });

    zoneDiv.appendChild(zoneNameDiv);
    zoneDiv.appendChild(timeSlotsDiv);
    dayDiv.appendChild(zoneDiv);
});

                applicantsListEl.appendChild(dayDiv);
            });
            console.log('Applicants list updated');
        }

        // íŠ¹ì • ìš”ì¼ì˜ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
        function getDateForDay(dayName) {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const dayMap = {
                'ì›”ìš”ì¼': 1, 'í™”ìš”ì¼': 2, 'ìˆ˜ìš”ì¼': 3, 'ëª©ìš”ì¼': 4,
                'ê¸ˆìš”ì¼': 5, 'í† ìš”ì¼': 6
            };
            const targetDate = new Date(sunday);
            targetDate.setDate(sunday.getDate() + dayMap[dayName]);
            return `${targetDate.getFullYear()}/${targetDate.getMonth() + 1}/${targetDate.getDate()}`;
        }
        // ========== ê³µì§€ì‚¬í•­ ê´€ë ¨ í•¨ìˆ˜ë“¤ ==========

// Firestoreì—ì„œ ê³µì§€ì‚¬í•­ ë¡œë“œ
async function loadNoticeFromFirestore() {
    try {
        const { doc, getDoc } = window.firestoreFunctions;
        const noticeRef = doc(window.db, 'notices', 'current');
        const noticeSnap = await getDoc(noticeRef);
        
        if (noticeSnap.exists()) {
            currentNotice = noticeSnap.data();
            console.log('Notice loaded:', currentNotice);
        } else {
            currentNotice = null;
            console.log('No notice found');
        }
        
        updateNoticeButton();
        
        // ì¤‘ìš”ê³µì§€ì´ê³  ë¡œê·¸ì¸ëœ ì‚¬ìš©ìë¼ë©´ ëª¨ë‹¬ í‘œì‹œ
        if (currentNotice && currentNotice.isImportant && currentUser && !isAdmin) {
            setTimeout(() => {
                openNoticeViewModal();
            }, 500); // ë¡œê·¸ì¸ ì™„ë£Œ í›„ ì ê¹ ë”œë ˆì´
        }
    } catch (error) {
        console.error('ê³µì§€ì‚¬í•­ ë¡œë“œ ì˜¤ë¥˜:', error);
    }
}

// ê³µì§€ì‚¬í•­ ì €ì¥
async function saveNotice() {
    const content = document.getElementById('noticeContent').value.trim();
    const isImportant = document.getElementById('isImportantNotice').checked;
    
    if (!content) {
        alert('ê³µì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    if (content.length > 300) {
        alert('ê³µì§€ì‚¬í•­ì€ 300ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    try {
        const { doc, setDoc } = window.firestoreFunctions;
        const noticeRef = doc(window.db, 'notices', 'current');
        
        const noticeData = {
            content: content,
            isImportant: isImportant,
            lastUpdated: new Date().toISOString(),
            updatedBy: 'admin',
            isActive: true
        };
        
        await setDoc(noticeRef, noticeData);
        
        currentNotice = noticeData;
        updateNoticeButton();
        
        alert('ê³µì§€ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        closeNoticeManagementModal();
        
        console.log('Notice saved:', noticeData);
    } catch (error) {
        console.error('ê³µì§€ì‚¬í•­ ì €ì¥ ì˜¤ë¥˜:', error);
        alert('ê³µì§€ì‚¬í•­ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

// ê³µì§€ì‚¬í•­ ì‚­ì œ
async function deleteNotice() {
    if (!currentNotice) {
        alert('ì‚­ì œí•  ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    if (!confirm('ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }
    
    try {
        const { doc, deleteDoc } = window.firestoreFunctions;
        const noticeRef = doc(window.db, 'notices', 'current');
        
        await deleteDoc(noticeRef);
        
        currentNotice = null;
        updateNoticeButton();
        
        alert('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        closeNoticeManagementModal();
        
        console.log('Notice deleted');
    } catch (error) {
        console.error('ê³µì§€ì‚¬í•­ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ê³µì§€ì‚¬í•­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

// ê³µì§€ ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°
function openNoticeManagementModal() {
    document.getElementById('noticeManagementModal').style.display = 'block';
    
    // í˜„ì¬ ê³µì§€ì‚¬í•­ ë‚´ìš© ë¡œë“œ
    if (currentNotice) {
        document.getElementById('noticeContent').value = currentNotice.content;
        document.getElementById('isImportantNotice').checked = currentNotice.isImportant || false;
        originalNoticeContent = currentNotice.content;
    } else {
        document.getElementById('noticeContent').value = '';
        document.getElementById('isImportantNotice').checked = false;
        originalNoticeContent = '';
    }
    
    updateCharCount();
    console.log('Notice management modal opened');
}

// ê³µì§€ ê´€ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
function closeNoticeManagementModal() {
    document.getElementById('noticeManagementModal').style.display = 'none';
    document.getElementById('noticeContent').value = '';
    document.getElementById('isImportantNotice').checked = false;
    console.log('Notice management modal closed');
}

// ê³µì§€ í¸ì§‘ ì·¨ì†Œ
function cancelNoticeEdit() {
    document.getElementById('noticeContent').value = originalNoticeContent;
    closeNoticeManagementModal();
}

// ê³µì§€ í™•ì¸ ëª¨ë‹¬ ì—´ê¸°
function openNoticeViewModal() {
    if (!currentNotice) {
        alert('í˜„ì¬ ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    document.getElementById('noticeViewModal').style.display = 'block';
    
    const titleElement = document.getElementById('noticeViewTitle');
    const contentElement = document.getElementById('noticeViewContent');
    const dateElement = document.getElementById('noticeViewDate');
    
    // ì œëª© ì„¤ì • (ì¤‘ìš”ê³µì§€ ì—¬ë¶€ì— ë”°ë¼)
    if (currentNotice.isImportant) {
        titleElement.textContent = 'ğŸ“¢ ì¤‘ìš” ê³µì§€';
        titleElement.className = 'important';
    } else {
        titleElement.textContent = 'ğŸ“¢ ê³µì§€ì‚¬í•­';
        titleElement.className = 'normal';
    }
    
    // ë‚´ìš© ì„¤ì •
    contentElement.textContent = currentNotice.content;
    
    // ë‚ ì§œ ì„¤ì •
    const date = new Date(currentNotice.lastUpdated);
    const dateString = ` ${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ë“±ë¡`;
    dateElement.textContent = dateString;
    
    console.log('Notice view modal opened');
}

// ê³µì§€ í™•ì¸ ëª¨ë‹¬ ë‹«ê¸°
function closeNoticeViewModal() {
    document.getElementById('noticeViewModal').style.display = 'none';
    console.log('Notice view modal closed');
}

// ê³µì§€ ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
function handleNoticeButtonClick() {
    if (currentNotice) {
        openNoticeViewModal();
    } else {
        alert('í˜„ì¬ ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.');
    }
}

// ê³µì§€ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
function updateNoticeButton() {
    const button = document.getElementById('noticeButton');
    const badge = document.getElementById('noticeBadge');
    
    if (currentNotice && currentNotice.isActive) {
        button.className = 'notice-button active';
        badge.style.display = 'block';
    } else {
        button.className = 'notice-button inactive';
        badge.style.display = 'none';
    }
}

// ê¸€ììˆ˜ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
function updateCharCount() {
    const content = document.getElementById('noticeContent').value;
    document.getElementById('noticeCharCount').textContent = content.length;
}

// ê¸€ììˆ˜ ì¹´ìš´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
document.addEventListener('DOMContentLoaded', function() {
    const noticeContent = document.getElementById('noticeContent');
    if (noticeContent) {
        noticeContent.addEventListener('input', updateCharCount);
    }
});

        // ìš”ì¼ ì„ íƒ ì‹œ êµ¬ì—­ ì„ íƒ ì˜ì—­ í‘œì‹œ
// ìš”ì¼ ì„ íƒ ì‹œ êµ¬ì—­ ì„ íƒ ì˜ì—­ í‘œì‹œ
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('input[name="day"]').forEach(radio => {
        radio.addEventListener('change', function () {
            const zoneContainer = document.getElementById('zoneSelectionContainer');
            if (this.checked) {
                zoneContainer.classList.add('show');
                
                // transitionì´ ë°˜ì˜ëœ í›„ì— ìŠ¤í¬ë¡¤ ì‹¤í–‰
                setTimeout(() => {
                    zoneContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100); // transition ì™„ë£Œ í›„ ìŠ¤í¬ë¡¤
                
                updateZoneDisplay(this.value);
                document.querySelectorAll('input[name="zone"]').forEach(zoneRadio => {
                    zoneRadio.checked = false;
                });
                console.log('Day selected:', this.value);
            }
        });
    });
});
        // êµ¬ì—­ ì„ íƒ ì‹œ ì‹œê°„ ì„ íƒ ì˜ì—­ í‘œì‹œ
document.addEventListener('change', function(e) {
    if (e.target.name === 'zone') {
        const selectedDay = document.querySelector('input[name="day"]:checked')?.value;
        const selectedZone = e.target.value;
        
        if (selectedDay && selectedZone) {
            const timeContainer = document.getElementById('timeSelectionContainer');
            timeContainer.classList.add('show');
            updateTimeSelection(selectedDay, selectedZone);
            
            // ê¸°ì¡´ ì‹œê°„ ì„ íƒ ì´ˆê¸°í™”
            document.querySelectorAll('input[name="time"]').forEach(timeRadio => {
                timeRadio.checked = false;
            });
            
            console.log('Zone selected:', selectedZone);
            
            timeContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
        if (e.target.name === 'admin-day') {
        const adminZoneContainer = document.getElementById('adminZoneSelectionContainer');
        adminZoneContainer.style.display = 'block';
    }
    
    // ê´€ë¦¬ì êµ¬ì—­ ì„ íƒ (ìƒˆë¡œ ì¶”ê°€)  
    if (e.target.name === 'admin-zone') {
        const selectedDay = document.querySelector('input[name="admin-day"]:checked')?.value;
        const selectedZone = e.target.value;
        if (selectedDay && selectedZone) {
            const adminTimeContainer = document.getElementById('adminTimeSelectionContainer');
            adminTimeContainer.style.display = 'block';
            updateAdminTimeSelection(selectedDay, selectedZone); // ì´ í•¨ìˆ˜ë„ ìƒˆë¡œ ë§Œë“¤ì–´ì•¼ í•¨
        }
    }
});


        // í¼ ì œì¶œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.getElementById('registrationForm').addEventListener('submit', async function (e) {
            e.preventDefault();
                const selectedDay = document.querySelector('input[name="day"]:checked');
                const selectedZone = document.querySelector('input[name="zone"]:checked');
                const selectedTime = document.querySelector('input[name="time"]:checked');

                if (!selectedDay) {
                    alert('ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    console.log('Form submission failed: No day selected');
                    return;
                }
                if (!selectedZone) {
                    alert('êµ¬ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    console.log('Form submission failed: No zone selected');
                    return;
                }
                if (!selectedTime) {
                    alert('ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    console.log('Form submission failed: No time selected');
                    return;
                }

            const dayValue = selectedDay.value;
            const zoneValue = selectedZone.value;
            const zoneObj = zones.find(z => z.name === zoneValue);
            const maxCapacity = zoneObj ? zoneObj.maxCapacity : 4;

            if (applicants[dayValue][zoneValue].length >= maxCapacity) {
                alert(`${dayValue} ${zoneValue}ì€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                console.log('Form submission failed: Zone at max capacity');
                return;
            }

                const timeValue = selectedTime.value;

                // ê°™ì€ ì‹œê°„ëŒ€ì— ì¤‘ë³µ ì‹ ì²­ ì²´í¬
// ê°™ì€ ì‹œê°„ëŒ€ì— ì¤‘ë³µ ì‹ ì²­ ì²´í¬ (ëª¨ë“  êµ¬ì—­ì—ì„œ)
let isDuplicate = false;
zones.forEach(zone => {
    if (applicants[dayValue][zone.name][timeValue] && 
        applicants[dayValue][zone.name][timeValue].includes(currentUser)) {
        isDuplicate = true;
    }
});

if (isDuplicate) {
    alert(`${dayValue} ${timeValue}ì— ì´ë¯¸ ë‹¤ë¥¸ êµ¬ì—­ì—ì„œ ì‹ ì²­í•˜ì…¨ìŠµë‹ˆë‹¤.`);
    return;
}
// ì¤‘ë³µ ì‹œê°„ëŒ€ í™•ì¸ (ìƒˆë¡œ ì¶”ê°€)
let isOverlappingTime = false;
userApplications.forEach(app => {
    if (app.day === dayValue && isOverlapping(timeValue, app.timeSlot)) {
        isOverlappingTime = true;
    }
});

if (isOverlappingTime) {
    alert(`${dayValue}ì— ì´ë¯¸ ê²¹ì¹˜ëŠ” ì‹œê°„ëŒ€(${timeValue})ì— ì‹ ì²­í•˜ì…¨ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.`);
    return; // ì‹ ì²­ ì¤‘ë‹¨
}

            const saved = await saveToFirestore(currentUser, dayValue, zoneValue, timeValue);
            if (saved) {
                alert(`${dayValue} ${zoneValue} ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);
                closeRegistrationModal();
            }
        });

        // ë§ˆê°ëœ êµ¬ì—­ í´ë¦­ ë°©ì§€
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('zone-label') && e.target.previousElementSibling.disabled) {
                e.preventDefault();
                const selectedDay = document.querySelector('input[name="day"]:checked') || document.querySelector('input[name="admin-day"]:checked');
                if (selectedDay) {
                    alert(`${selectedDay.value} ${e.target.dataset.zone}ì€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function (event) {
            const registrationModal = document.getElementById('registrationModal');
            const cancelModal = document.getElementById('cancelModal');
            const adminModal = document.getElementById('adminModal');
            const userManagementModal = document.getElementById('userManagementModal');
            const zoneManagementModal = document.getElementById('zoneManagementModal');
            const statsModal = document.getElementById('statsModal');
            const noticeManagementModal = document.getElementById('noticeManagementModal');
            const noticeViewModal = document.getElementById('noticeViewModal');

            if (event.target === registrationModal) {
                closeRegistrationModal();
            }
            if (event.target === cancelModal) {
                closeCancelModal();
            }
            if (event.target === adminModal) {
                closeAdminModal();
            }
            if (event.target === userManagementModal) {
                closeUserManagementModal();
            }
            if (event.target === zoneManagementModal) {
                closeZoneManagementModal();
            }
            if (event.target === statsModal) {
                closeStatsModal();
            }
            if (event.target === noticeManagementModal) {
                closeNoticeManagementModal();
            }
            if (event.target === noticeViewModal) {
                closeNoticeViewModal();
            }
        };

        // ê´€ë¦¬ì ëª¨ë‹¬ ë‹«ê¸°
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        // ê´€ë¦¬ì ì•¡ì…˜ ì‹¤í–‰
// ì•½ 1460ë²ˆì§¸ ì¤„ì˜ í•¨ìˆ˜ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •
async function executeAdminAction() {
    const selectedUser = document.getElementById('adminUserSelect').value;
    const selectedAction = document.getElementById('adminAction').value;
    const selectedDay = document.querySelector('input[name="admin-day"]:checked')?.value;
    const selectedZone = document.querySelector('input[name="admin-zone"]:checked')?.value;
    const selectedTime = document.querySelector('input[name="admin-time"]:checked')?.value;
    
    if (!selectedUser || !selectedAction) {
        alert('ì‚¬ìš©ìì™€ ì‘ì—…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    if (selectedAction === 'assign') {
        if (!selectedDay || !selectedZone || !selectedTime) {
            alert('ìš”ì¼, êµ¬ì—­, ì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        const saved = await saveToFirestore(selectedUser, selectedDay, selectedZone, selectedTime);
        if (saved) {
            alert(`${selectedUser}ë‹˜ì´ ${selectedDay} ${selectedZone} ${selectedTime}ì— ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            resetAdminForm();
        }
    } else if (selectedAction === 'cancel') {
        // ì·¨ì†Œ ë¡œì§ì€ ë³„ë„ UI í•„ìš”
        showAdminCancelOptions(selectedUser);
    }
}

        // ê´€ë¦¬ì í¼ ì´ˆê¸°í™”
        function resetAdminForm() {
            alert('í¼ ì´ˆê¸°í™” (êµ¬í˜„ í•„ìš”)');
        }</script>

        <!-- í”Œë¡œíŒ… ë©”ë‰´ë¥¼ body íƒœê·¸ ëë‚˜ê¸° ì „ì— ì¶”ê°€ -->
<div class="floating-menu-container" id="floatingMenu">
        <!-- ê¸€ì í¬ê¸° ì¡°ì • ë²„íŠ¼ -->
        <div class="sub-menu-btn font-size-btn" onclick="toggleFontSizeSlider()" title="ê¸€ì í¬ê¸° ì¡°ì •">
        Aa
    </div>
    <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
    <button class="sub-menu-btn dark-mode-btn" onclick="toggleDarkMode()" title="ë‹¤í¬ëª¨ë“œ ì „í™˜">
        ğŸŒ™
    </button>
    
    <!-- êµ¬ì—­ì¹´ë“œ ë²„íŠ¼ -->
    <button class="sub-menu-btn home-btn" onclick="goToHome()" title="í™ˆìœ¼ë¡œ ì´ë™">
        ğŸ 
    </button>
    
    <!-- ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ -->
    <button class="floating-menu-btn" onclick="toggleFloatingMenu()" title="ë©”ë‰´">
        <div class="hamburger-icon">
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
        </div>
    </button>
        <!-- ê¸€ì í¬ê¸° ìŠ¬ë¼ì´ë” (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
    <div class="font-size-slider-container" id="fontSizeSlider">
        <div class="slider-header">
            <span>ê¸€ì í¬ê¸°</span>
            <button class="close-slider" onclick="closeFontSizeSlider()">Ã—</button>
        </div>
        <input type="range" id="fontSizeRange" min="12" max="24" value="16" step="1">
        <div class="slider-value" id="fontSizeValue">16px</div>
    </div>
</div>

<script>
// í”Œë¡œíŒ… ë©”ë‰´ í† ê¸€ í•¨ìˆ˜
function toggleFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    menu.classList.toggle('open');
}

// ë‹¤í¬ëª¨ë“œ í† ê¸€ í•¨ìˆ˜
function toggleDarkMode() {
    const body = document.body;
    const darkModeBtn = document.querySelector('.dark-mode-btn');
    
    body.classList.toggle('dark-mode');
    
    // ë‹¤í¬ëª¨ë“œ ìƒíƒœì— ë”°ë¼ ì•„ì´ì½˜ ë³€ê²½
    if (body.classList.contains('dark-mode')) {
        darkModeBtn.innerHTML = 'â˜€ï¸';
        darkModeBtn.title = 'ë¼ì´íŠ¸ëª¨ë“œ ì „í™˜';
        localStorage.setItem('darkMode', 'enabled');
    } else {
        darkModeBtn.innerHTML = 'ğŸŒ™';
        darkModeBtn.title = 'ë‹¤í¬ëª¨ë“œ ì „í™˜';
        localStorage.setItem('darkMode', 'disabled');
    }
    // ê¸€ì í¬ê¸° ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
    updateFontSizeButtonColor();
}

// í™ˆìœ¼ë¡œ ì´ë™ í•¨ìˆ˜
function goToHome() {
    window.open('https://bgs.jwcard.co.kr', '_blank');
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë‹¤í¬ëª¨ë“œ ìƒíƒœ ë³µì›
document.addEventListener('DOMContentLoaded', function() {
    const darkMode = localStorage.getItem('darkMode');
    const darkModeBtn = document.querySelector('.dark-mode-btn');
    
    if (darkMode === 'enabled') {
        document.body.classList.add('dark-mode');
        darkModeBtn.innerHTML = 'â˜€ï¸';
        darkModeBtn.title = 'ë¼ì´íŠ¸ëª¨ë“œ ì „í™˜';
    }
});

// ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.addEventListener('click', function(event) {
    const menu = document.getElementById('floatingMenu');
    const isClickInsideMenu = menu.contains(event.target);
    
    if (!isClickInsideMenu && menu.classList.contains('open')) {
        menu.classList.remove('open');
    }
});

// ESC í‚¤ë¡œ ë©”ë‰´ ë‹«ê¸°
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const menu = document.getElementById('floatingMenu');
        if (menu.classList.contains('open')) {
            menu.classList.remove('open');
        }
    }
});
</script>
</body>
</html>
