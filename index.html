<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∂àÍ¥ëÏÑúÎ∂ÄÌöåÏ§ë Ï†ÑÏãúÎåÄ Ïã†Ï≤≠</title>
    <link rel="apple-touch-icon" href="apple-touch-icon_v3.png">
    <link rel="icon" type="image/png" href="favicon-512x512_v3.png">

    <!-- Firebase SDK -->
    <script type="module">import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, onSnapshot, deleteDoc, doc, setDoc, updateDoc, arrayUnion, arrayRemove, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';


        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyCUe4dXiwGiMsKtMCQfLVScx9iM4sEwF50",
            authDomain: "cart-witnessing-404c0.firebaseapp.com",
            projectId: "cart-witnessing-404c0",
            storageBucket: "cart-witnessing-404c0.firebasestorage.app",
            messagingSenderId: "616001042576",
            appId: "1:616001042576:web:314fe2268c8fffe82a8015",
            measurementId: "G-HT3T8YS1MW"
        };


        // Firebase Ï¥àÍ∏∞Ìôî
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Ï†ÑÏó≠ÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎèÑÎ°ù window Í∞ùÏ≤¥Ïóê Ï†ÄÏû•
        window.firebaseApp = app;
        window.db = db;
        window.firestoreFunctions = {
            collection, addDoc, getDocs, query, where, onSnapshot, deleteDoc, doc, setDoc, updateDoc, arrayUnion, arrayRemove, getDoc
        };


        // DOMÏù¥ Î°úÎìúÎêú ÌõÑ Ïã§Ìñâ
        window.addEventListener('DOMContentLoaded', function () {
            window.initializeApp();
        });</script>

    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(145deg, #667eea 0%, #764ba2 50%, #667eea 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 0;
    color: #1a202c;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 0;
    border-radius: 0;
    box-shadow: none;
    width: 100%;
    max-width: 100%;
    min-height: 100vh;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

h1 {
    text-align: center;
    color: #1a202c;
    margin: 0;
    padding: 40px 20px 30px;
    font-size: 26px;
    font-weight: 800;
    line-height: 1.3;
    position: relative;
    z-index: 2;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.login-page, .main-page, .admin-page {
    padding: 20px;
    position: relative;
    z-index: 2;
    margin-top: 20px;
    flex-shrink: 0;
}

.login-page {
    display: block;
}

.main-page, .admin-page {
    display: none;
}

.form-group {
    margin-bottom: 24px;
}

label {
    display: block;
    margin-bottom: 10px;
    color: #2d3748;
    font-weight: 600;
    font-size: 15px;
    text-align: left;
}

input[type="text"], select, textarea, input[type="number"] {
    width: 100%;
    padding: 18px 20px;
    border: none;
    border-radius: 16px;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(102, 126, 234, 0.2);
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}

input[type="text"]:focus, select:focus, textarea:focus, input[type="number"]:focus {
    outline: none;
    background: white;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), 0 8px 30px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.btn {
    width: 100%;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 16px;
    font-size: 17px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin-bottom: 14px;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.6s;
}

.btn:hover::before {
    left: 100%;
}

.btn:active {
    transform: scale(0.98);
}

.btn.secondary {
    background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
    box-shadow: 0 8px 25px rgba(160, 174, 192, 0.3);
}

.btn.danger {
    background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%);
    padding: 14px 20px;
    width: auto;
    font-size: 14px;
    margin: 0;
    box-shadow: 0 6px 20px rgba(252, 129, 129, 0.3);
    border-radius: 12px;
}

.btn.success {
    background: linear-gradient(135deg, #68d391 0%, #38a169 100%);
    padding: 16px 24px;
    width: auto;
    font-size: 15px;
    margin: 0 5px;
    box-shadow: 0 6px 20px rgba(104, 211, 145, 0.3);
    border-radius: 12px;
}

.btn.admin {
    background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
    box-shadow: 0 8px 25px rgba(246, 173, 85, 0.3);
}

.btn.small {
    padding: 16px 22px;
    font-size: 15px;
    width: auto;
}

.btn:disabled {
    background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.user-info, .admin-info {
    text-align: center;
    margin: 20px 0 32px;
    font-size: 18px;
    font-weight: 600;
    padding: 20px;
    border-radius: 16px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.user-info {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    color: #667eea;
}

.admin-info {
    background: linear-gradient(135deg, rgba(246, 173, 85, 0.1) 0%, rgba(237, 137, 54, 0.1) 100%);
    color: #ed8936;
}

.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 14px;
    margin-bottom: 32px;
}

.admin-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-bottom: 32px;
}

.day-selection {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-top: 16px;
}

.zone-selection {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-top: 16px;
}

.day-option, .zone-option {
    position: relative;
}

.day-option input[type="radio"], .zone-option input[type="radio"] {
    display: none;
}

.day-label, .zone-label {
    display: block;
    padding: 20px 16px;
    border: none;
    border-radius: 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(102, 126, 234, 0.1);
    font-weight: 600;
    font-size: 15px;
    position: relative;
    overflow: hidden;
}

.zone-label {
    padding: 24px 20px;
    font-size: 16px;
}

.day-label::before, .zone-label::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.day-option input[type="radio"]:checked + .day-label,
.zone-option input[type="radio"]:checked + .zone-label {
    color: white;
    border-color: #667eea;
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
    transform: translateY(-2px);
}

.day-option input[type="radio"]:checked + .day-label::before,
.zone-option input[type="radio"]:checked + .zone-label::before {
    opacity: 1;
}

.day-label:active, .zone-label:active {
    transform: scale(0.98);
}

.date-info {
    font-size: 12px;
    margin-top: 6px;
    color: #718096;
    font-weight: 500;
}

.day-option input[type="radio"]:checked + .day-label .date-info {
    color: rgba(255, 255, 255, 0.9);
}

.capacity-info {
    font-size: 13px;
    margin-top: 8px;
    text-align: center;
    color: #718096;
    font-weight: 600;
    padding: 4px 8px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    display: inline-block;
}

.zone-label .capacity-info {
    font-size: 14px;
}

.applicants-list {
    margin-top: 32px;
    padding: 0;
    background: none;
    border-radius: 0;
    flex-grow: 1;
    overflow-y: auto;
    max-height: calc(100vh - 300px);
}

.applicants-list h3 {
    margin-bottom: 20px;
    color: #1a202c;
    font-size: 20px;
    font-weight: 800;
    text-align: center;
    padding: 0 20px;
}

.day-section {
    margin-bottom: 16px;
    padding: 0;
    background: none;
    border-radius: 0;
}

.day-title {
    font-weight: 800;
    color: #667eea;
    margin-bottom: 12px;
    font-size: 18px;
    padding: 0 20px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 16px 20px;
    margin: 0 20px 12px;
    border: 1px solid rgba(102, 126, 234, 0.1);
}

.zone-applicants {
    margin: 0 20px 10px;
    padding: 18px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.zone-name {
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 10px;
    font-size: 15px;
}

.name-tag {
    display: inline-block;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 8px 14px;
    margin: 4px 6px 4px 0;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
    position: relative;
    overflow: hidden;
}

.name-tag::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.6s;
}

.name-tag:hover::before {
    left: 100%;
}

.applicant-names {
    line-height: 1.8;
    color: #4a5568;
    font-size: 14px;
}

.zone-selection-container {
    display: none;
}

.zone-selection-container.show {
    display: block;
    animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideUp {
    from { 
        opacity: 0; 
        transform: translateY(20px);
    }
    to { 
        opacity: 1; 
        transform: translateY(0);
    }
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(8px);
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    margin: 0;
    padding: 30px 20px;
    border-radius: 24px 24px 0 0;
    width: 100%;
    max-width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
    animation: slideUpModal 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideUpModal {
    from {
        transform: translateY(100%);
    }
    to {
        transform: translateY(0);
    }
}

.modal-content.large {
    max-width: 100%;
}

.close {
    position: absolute;
    right: 20px;
    top: 20px;
    color: #a0aec0;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    background: rgba(255, 255, 255, 0.8);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.close:hover {
    color: #2d3748;
    background: white;
    transform: scale(1.1);
}

.modal h2 {
    text-align: center;
    color: #1a202c;
    margin-bottom: 32px;
    font-size: 24px;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.cancel-list {
    max-height: 400px;
    overflow-y: auto;
    padding-right: 5px;
}

.cancel-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    margin-bottom: 12px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
}

.cancel-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
}

.cancel-info {
    flex: 1;
}

.cancel-day {
    font-weight: 800;
    color: #667eea;
    font-size: 17px;
}

.cancel-details {
    color: #718096;
    font-size: 14px;
    margin-top: 4px;
    font-weight: 500;
}

.no-applications {
    text-align: center;
    color: #a0aec0;
    font-style: italic;
    padding: 60px 20px;
    font-size: 16px;
    font-weight: 500;
}

.admin-form {
    margin-bottom: 24px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    margin-bottom: 20px;
}

.admin-action-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
}

.stats-header {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 16px;
}

.month-navigation {
    display: flex;
    align-items: center;
    gap: 16px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    padding: 12px 20px;
    border-radius: 16px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}

.month-nav-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 12px;
    width: 44px;
    height: 44px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.month-nav-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.current-month {
    font-size: 18px;
    font-weight: 700;
    color: #2d3748;
    min-width: 120px;
    text-align: center;
}

.stats-content {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    padding: 24px;
    border-radius: 16px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
}

.stats-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 12px;
    margin-bottom: 24px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    padding: 20px;
    border-radius: 16px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-3px);
}

.stat-number {
    font-size: 28px;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 6px;
}

.stat-label {
    font-size: 13px;
    color: #718096;
    font-weight: 600;
}

.zone-stats {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}

.zone-stat-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    padding: 18px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: transform 0.3s ease;
}

.zone-stat-card:hover {
    transform: translateY(-2px);
}

.zone-stat-title {
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 12px;
    font-size: 16px;
}

.zone-stat-bar {
    background: rgba(226, 232, 240, 0.8);
    border-radius: 8px;
    height: 10px;
    margin-bottom: 8px;
    overflow: hidden;
    backdrop-filter: blur(5px);
}

.zone-stat-fill {
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 8px;
    height: 100%;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.zone-stat-text {
    font-size: 14px;
    color: #718096;
    font-weight: 600;
}

.user-list {
    margin-top: 28px;
    padding: 24px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(15px);
    border-radius: 16px;
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
}

.user-list h3 {
    margin-bottom: 18px;
    color: #1a202c;
    font-size: 18px;
    font-weight: 700;
}

.user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px;
    margin-bottom: 10px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}

.user-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}

.user-name {
    font-weight: 600;
    color: #2d3748;
    font-size: 16px;
}

.version-info {
    text-align: center;
    font-size: 11px;
    color: rgba(255, 255, 255, 0.7);
    margin-top: 20px;
    font-weight: 500;
    padding: 0 20px;
}

.notice-button {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 52px;
    height: 52px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    font-size: 20px;
    z-index: 999;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.notice-button.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

.notice-button.inactive {
    background: rgba(255, 255, 255, 0.9);
    color: #718096;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.notice-button:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
}

.notice-badge {
    position: absolute;
    top: -2px;
    right: -2px;
    width: 14px;
    height: 14px;
    background: #e53e3e;
    border-radius: 50%;
    display: none;
    box-shadow: 0 2px 8px rgba(229, 62, 62, 0.4);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.notice-modal-content h2.important {
    color: #e53e3e;
}

.notice-modal-content h2.normal {
    color: #667eea;
}

.notice-date {
    font-size: 12px;
    color: #a0aec0;
    text-align: center;
    margin-top: 18px;
    font-weight: 500;
}

.important-notice-checkbox {
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(102, 126, 234, 0.1);
}

.important-notice-checkbox input[type="checkbox"] {
    width: auto;
    margin: 0;
    transform: scale(1.3);
    accent-color: #667eea;
}

.important-notice-checkbox label {
    font-size: 15px;
    color: #2d3748;
    cursor: pointer;
    margin: 0;
    font-weight: 600;
}

::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6b46c1 100%);
}

@media (max-width: 768px) {
    body {
        padding: 0;
        align-items: flex-start;
    }
    
    .container {
        border-radius: 0;
        min-height: 100vh;
    }
    
    h1 {
        font-size: 24px;
        padding: 35px 20px 25px;
    }
    
    .admin-actions {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .day-selection {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .modal-content {
        padding: 25px 20px 35px;
        border-radius: 20px 20px 0 0;
        max-height: 85vh;
    }
    
    .stats-summary {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .cancel-item {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
    }
    
    .cancel-item .btn {
        width: 100%;
        margin: 0;
    }
    
    .notice-button {
        top: 16px;
        right: 16px;
        width: 48px;
        height: 48px;
        font-size: 18px;
    }
    
    .action-buttons .btn {
        padding: 22px;
        font-size: 18px;
        font-weight: 700;
    }
}

@supports (padding: max(0px)) {
    .container {
        padding-top: max(20px, env(safe-area-inset-top));
    }
    
    .notice-button {
        top: max(20px, calc(env(safe-area-inset-top) + 10px));
        right: max(20px, calc(env(safe-area-inset-right) + 10px));
    }
}

@media (prefers-color-scheme: dark) {
    body {
        background: linear-gradient(145deg, #4c51bf 0%, #553c9a 50%, #4c51bf 100%);
    }
    
    .container {
        background: rgba(26, 32, 44, 0.95);
        color: #e2e8f0;
    }
    
    h1 {
        color: #e2e8f0;
    }
    
    input[type="text"], select, textarea, input[type="number"] {
        background: rgba(45, 55, 72, 0.8);
        border-color: rgba(102, 126, 234, 0.3);
        color: #e2e8f0;
    }
    
    .applicants-list {
        background: none;
    }
    
    .day-title {
        background: rgba(45, 55, 72, 0.8);
        color: #9f7aea;
    }
    
    .zone-applicants {
        background: rgba(45, 55, 72, 0.9);
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .zone-name {
        color: #e2e8f0;
    }
    
    .applicant-names {
        color: #cbd5e0;
    }
}

@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .btn::before {
        display: none;
    }
    
    .name-tag::before {
        display: none;
    }
}

@media (prefers-contrast: high) {
    .btn {
        border: 2px solid #2d3748;
    }
    
    .day-label, .zone-label {
        border: 2px solid #4a5568;
    }
    
    .day-option input[type="radio"]:checked + .day-label,
    .zone-option input[type="radio"]:checked + .zone-label {
        border: 2px solid #1a202c;
    }
}

@media (hover: none) and (pointer: coarse) {
    .btn:hover {
        transform: none;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .day-label:hover, .zone-label:hover {
        transform: none;
        box-shadow: none;
        background: rgba(255, 255, 255, 0.7);
    }
    
    .cancel-item:hover {
        transform: none;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    
    .stat-card:hover, .zone-stat-card:hover, .user-item:hover {
        transform: none;
    }
    
    .btn:active {
        transform: scale(0.97);
        transition: transform 0.1s ease;
    }
    
    .day-label:active, .zone-label:active {
        transform: scale(0.97);
        transition: transform 0.1s ease;
    }
}

@media (max-width: 390px) {
    .container {
        padding: 20px 16px;
    }
    
    h1 {
        font-size: 22px;
        padding: 30px 16px 20px;
    }
    
    .btn {
        font-size: 16px;
        padding: 20px;
    }
    
    .modal-content {
        padding: 20px 16px 30px;
    }
    
    .modal h2 {
        font-size: 20px;
    }
    
    .stats-summary {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .month-navigation {
        padding: 10px 16px;
        gap: 12px;
    }
    
    .current-month {
        font-size: 16px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ -->
        <div class="login-page" id="loginPage">
            <h1>Î∂àÍ¥ëÏÑúÎ∂ÄÌöåÏ§ë<br>Ï†ÑÏãúÎåÄ Î¥âÏÇ¨ Ïã†Ï≤≠</h1>

            <div class="login-form">
                <div class="form-group">
                    <label for="loginName">Ïù¥Î¶Ñ</label>
                    <input type="text" id="loginName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                </div>
                <button type="button" class="btn" onclick="login()">ÌôïÏù∏</button>
            </div>
        </div>

        <!-- ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê Î©îÏù∏ ÌéòÏù¥ÏßÄ -->
        <div class="main-page" id="mainPage">
            <h1>Î∂àÍ¥ëÏÑúÎ∂ÄÌöåÏ§ë<br>Ï†ÑÏãúÎåÄ Î¥âÏÇ¨ Ïã†Ï≤≠</h1>

            <div class="user-info" id="userInfo"></div>

            <div class="action-buttons">
                <button type="button" class="btn" onclick="openRegistrationModal()">Ï†ÑÏãúÎåÄ Î¥âÏÇ¨ Ïã†Ï≤≠</button>
                <button type="button" class="btn secondary" onclick="openCancelModal()">Ïã†Ï≤≠ Ï∑®ÏÜå</button>
            </div>
        </div>

        <!-- Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ -->
        <div class="admin-page" id="adminPage">
            <h1>Í¥ÄÎ¶¨Ïûê Î™®Îìú</h1>

            <div class="admin-info">Í¥ÄÎ¶¨ÏûêÎãò ÌôòÏòÅÌï©ÎãàÎã§!</div>

            <div class="admin-actions">
                <button type="button" class="btn admin" onclick="openUserManagementModal()">ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</button>
                <button type="button" class="btn admin" onclick="openZoneManagementModal()">Íµ¨Ïó≠ Í¥ÄÎ¶¨</button>
                <button type="button" class="btn admin" onclick="openNoticeManagementModal()">Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</button>
                <button type="button" class="btn secondary" onclick="openStatsModal()">Îç∞Ïù¥ÌÑ∞ ÌÜµÍ≥Ñ</button>
            </div>
        </div>

        <!-- Ïã†Ï≤≠ ÌòÑÌô© -->
        <div class="applicants-list">
            <h3>Ïã†Ï≤≠ ÌòÑÌô©</h3>
            <div id="applicantsList"></div>
        </div>
        <div class="version-info">v.2</div>
    </div>
    <!-- Í≥†Ï†ï Í≥µÏßÄ Î≤ÑÌäº -->
<button id="noticeButton" class="notice-button inactive" onclick="handleNoticeButtonClick()" style="display: none;">
    üì¢
    <div id="noticeBadge" class="notice-badge"></div>
</button>

    <!-- Ïã†Ï≤≠ Î™®Îã¨ -->
    <div id="registrationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRegistrationModal()">&times;</span>
            <h2>Ï†ÑÏãúÎåÄ Î¥âÏÇ¨ Ïã†Ï≤≠</h2>

            <form id="registrationForm">
                <div class="form-group">
                    <label>ÏöîÏùº ÏÑ†ÌÉù</label>
                    <div class="day-selection">
                        <div class="day-option">
                            <input type="radio" id="monday" name="day" value="ÏõîÏöîÏùº">
                            <label for="monday" class="day-label" data-day="ÏõîÏöîÏùº">
                                ÏõîÏöîÏùº
                                <div class="date-info" id="monday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="tuesday" name="day" value="ÌôîÏöîÏùº">
                            <label for="tuesday" class="day-label" data-day="ÌôîÏöîÏùº">
                                ÌôîÏöîÏùº
                                <div class="date-info" id="tuesday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="wednesday" name="day" value="ÏàòÏöîÏùº">
                            <label for="wednesday" class="day-label" data-day="ÏàòÏöîÏùº">
                                ÏàòÏöîÏùº
                                <div class="date-info" id="wednesday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="thursday" name="day" value="Î™©ÏöîÏùº">
                            <label for="thursday" class="day-label" data-day="Î™©ÏöîÏùº">
                                Î™©ÏöîÏùº
                                <div class="date-info" id="thursday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="friday" name="day" value="Í∏àÏöîÏùº">
                            <label for="friday" class="day-label" data-day="Í∏àÏöîÏùº">
                                Í∏àÏöîÏùº
                                <div class="date-info" id="friday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="saturday" name="day" value="ÌÜ†ÏöîÏùº">
                            <label for="saturday" class="day-label" data-day="ÌÜ†ÏöîÏùº">
                                ÌÜ†ÏöîÏùº
                                <div class="date-info" id="saturday-date"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group zone-selection-container" id="zoneSelectionContainer">
                    <label>Íµ¨Ïó≠ ÏÑ†ÌÉù</label>
                    <div class="zone-selection" id="zoneSelection">
                        <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
                    </div>
                </div>

                <button type="submit" class="btn">Ïã†Ï≤≠ÌïòÍ∏∞</button>
            </form>
        </div>
    </div>

    <!-- Ïã†Ï≤≠ Ï∑®ÏÜå Î™®Îã¨ -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCancelModal()">&times;</span>
            <h2>Ïã†Ï≤≠ Ï∑®ÏÜå</h2>

            <div id="cancelList" class="cancel-list">
                <!-- Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
            </div>
        </div>
    </div>

    <!-- Í¥ÄÎ¶¨Ïûê Î™®Îã¨ -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminModal()">&times;</span>
            <h2>Ïã†Ï≤≠ Í¥ÄÎ¶¨</h2>

            <div class="admin-form">
                <div class="form-group">
                    <label for="adminUserSelect">ÏÇ¨Ïö©Ïûê ÏÑ†ÌÉù</label>
                    <select id="adminUserSelect">
                        <option value="">ÏÇ¨Ïö©ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                        <!-- ÏÇ¨Ïö©Ïûê Î™©Î°ùÏùÄ JSÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú Ï±ÑÏõåÏßê -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="adminAction">ÏûëÏóÖ</label>
                    <select id="adminAction">
                        <option value="">ÏûëÏóÖÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                        <option value="assign">ÏûÑÏùò Î∞∞Ï†ï</option>
                        <option value="cancel">ÏûÑÏùò Ï∑®ÏÜå</option>
                    </select>
                </div>

                <div class="form-group" id="adminDayZoneRow" style="display: none;">
                    <label>ÏöîÏùº ÏÑ†ÌÉù</label>
                    <div class="day-selection">
                        <div class="day-option">
                            <input type="radio" id="admin-monday" name="admin-day" value="ÏõîÏöîÏùº">
                            <label for="admin-monday" class="day-label" data-day="ÏõîÏöîÏùº">
                                ÏõîÏöîÏùº
                                <div class="date-info" id="admin-monday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-tuesday" name="admin-day" value="ÌôîÏöîÏùº">
                            <label for="admin-tuesday" class="day-label" data-day="ÌôîÏöîÏùº">
                                ÌôîÏöîÏùº
                                <div class="date-info" id="admin-tuesday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-wednesday" name="admin-day" value="ÏàòÏöîÏùº">
                            <label for="admin-wednesday" class="day-label" data-day="ÏàòÏöîÏùº">
                                ÏàòÏöîÏùº
                                <div class="date-info" id="admin-wednesday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-thursday" name="admin-day" value="Î™©ÏöîÏùº">
                            <label for="admin-thursday" class="day-label" data-day="Î™©ÏöîÏùº">
                                Î™©ÏöîÏùº
                                <div class="date-info" id="admin-thursday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-friday" name="admin-day" value="Í∏àÏöîÏùº">
                            <label for="admin-friday" class="day-label" data-day="Í∏àÏöîÏùº">
                                Í∏àÏöîÏùº
                                <div class="date-info" id="admin-friday-date"></div>
                            </label>
                        </div>
                        <div class="day-option">
                            <input type="radio" id="admin-saturday" name="admin-day" value="ÌÜ†ÏöîÏùº">
                            <label for="admin-saturday" class="day-label" data-day="ÌÜ†ÏöîÏùº">
                                ÌÜ†ÏöîÏùº
                                <div class="date-info" id="admin-saturday-date"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group zone-selection-container" id="adminZoneSelectionContainer" style="display: none;">
                    <label>Íµ¨Ïó≠ ÏÑ†ÌÉù</label>
                    <div class="zone-selection" id="adminZoneSelection">
                        <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
                    </div>
                </div>

                <div id="adminCancelList" style="display: none;">
                    <h4>Ï∑®ÏÜåÌï† Ïã†Ï≤≠ ÏÑ†ÌÉù</h4>
                    <div id="adminCancelOptions"></div>
                </div>

                <div class="admin-action-buttons">
                    <button type="button" class="btn success small" onclick="executeAdminAction()">Ïã§Ìñâ</button>
                    <button type="button" class="btn secondary small" onclick="resetAdminForm()">Ï¥àÍ∏∞Ìôî</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Î™®Îã¨ -->
    <div id="userManagementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserManagementModal()">&times;</span>
            <h2>ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h2>

            <div class="form-group">
                <label for="newUserName">ÏÉà ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä</label>
                <input type="text" id="newUserName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                <button type="button" class="btn success small" onclick="addNewUser()" style="margin-top: 10px;">Ï∂îÍ∞Ä</button>
            </div>

            <div class="user-list">
                <h3>Îì±Î°ùÎêú ÏÇ¨Ïö©Ïûê</h3>
                <div id="userManagementList"></div>
            </div>
        </div>
    </div>

    <!-- Íµ¨Ïó≠ Í¥ÄÎ¶¨ Î™®Îã¨ -->
    <div id="zoneManagementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeZoneManagementModal()">&times;</span>
            <h2>Íµ¨Ïó≠ Í¥ÄÎ¶¨</h2>

            <div class="form-group">
                <label for="newZoneName">ÏÉà Íµ¨Ïó≠ Ï∂îÍ∞Ä</label>
                <input type="text" id="newZoneName" placeholder="Íµ¨Ïó≠ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
            </div>
            <div class="form-group">
                <label for="newZoneCapacity">ÏµúÎåÄ Ïö©Îüâ</label>
                <input type="number" id="newZoneCapacity" placeholder="ÏµúÎåÄ Ïö©Îüâ (Í∏∞Î≥∏ 4)" value="4" min="1" required>
                <button type="button" class="btn success small" onclick="addNewZone()" style="margin-top: 10px;">Ï∂îÍ∞Ä</button>
            </div>

            <div class="user-list">
                <h3>Îì±Î°ùÎêú Íµ¨Ïó≠</h3>
                <div id="zoneManagementList"></div>
            </div>
        </div>
    </div>

    <!-- Îç∞Ïù¥ÌÑ∞ ÌÜµÍ≥Ñ Î™®Îã¨ -->
    <div id="statsModal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeStatsModal()">&times;</span>
            <h2>Îç∞Ïù¥ÌÑ∞ ÌÜµÍ≥Ñ</h2>

            <div class="stats-header">
                <div class="month-navigation">
                    <button class="month-nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
                    <div class="current-month" id="currentMonth"></div>
                    <button class="month-nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
                </div>
            </div>

            <div class="stats-content">
                <div class="stats-summary" id="statsSummary"></div>
                <div class="zone-stats" id="zoneStats"></div>
            </div>
        </div>
    </div>
    <!-- Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨ Î™®Îã¨ -->
<div id="noticeManagementModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeNoticeManagementModal()">&times;</span>
        <h2>Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</h2>

        <div class="form-group">
            <label for="noticeContent">Í≥µÏßÄ ÎÇ¥Ïö©</label>
            <textarea id="noticeContent" rows="5" placeholder="Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." style="width: 100%; padding: 15px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 16px; resize: vertical; min-height: 120px;"></textarea>
        </div>

        <div class="important-notice-checkbox">
            <input type="checkbox" id="isImportantNotice">
            <label for="isImportantNotice">Ï§ëÏöî Í≥µÏßÄ (Î°úÍ∑∏Ïù∏ Ïãú ÏûêÎèô ÌëúÏãú)</label>
        </div>

        <div style="text-align: right; margin-bottom: 20px; color: #999; font-size: 14px;">
            Í∏ÄÏûêÏàò: <span id="noticeCharCount">0</span>/300
        </div>

        <div class="admin-action-buttons">
            <button type="button" class="btn success small" onclick="saveNotice()">Í≥µÏßÄ Ï†ÄÏû•</button>
            <button type="button" class="btn danger small" onclick="deleteNotice()">Í≥µÏßÄ ÏÇ≠Ï†ú</button>
            <button type="button" class="btn secondary small" onclick="cancelNoticeEdit()">Ï∑®ÏÜå</button>
        </div>
    </div>
</div>
<!-- Í≥µÏßÄÏÇ¨Ìï≠ ÌôïÏù∏ Î™®Îã¨ -->
<div id="noticeViewModal" class="modal">
    <div class="modal-content notice-modal-content">
        <span class="close" onclick="closeNoticeViewModal()">&times;</span>
        <h2 id="noticeViewTitle">üì¢ Í≥µÏßÄÏÇ¨Ìï≠</h2>
        
        <div id="noticeViewContent" style="margin: 20px 0; line-height: 1.6; font-size: 16px;">
            <!-- Í≥µÏßÄ ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
        </div>
        
        <div id="noticeViewDate" class="notice-date">
            <!-- Îì±Î°ù ÎÇ†ÏßúÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button type="button" class="btn" onclick="closeNoticeViewModal()">ÌôïÏù∏</button>
        </div>
    </div>
</div>

    <script>// Ïã†Ï≤≠Ïûê Îç∞Ïù¥ÌÑ∞Î•º Ï†ÄÏû•Ìï† Í∞ùÏ≤¥
        const applicants = {};
        const days = ['ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];
        let zones = []; // ÎèôÏ†ÅÏúºÎ°ú Î°úÎìú
        let currentUser = '';
        let isAdmin = false;
        let userApplications = [];
        let allApplications = [];
        let currentStatsYear = new Date().getFullYear();
        let currentStatsMonth = new Date().getMonth() + 1;
        let allowedUsers = []; // ÏÑúÎ≤ÑÏóêÏÑú Î°úÎìúÎê† Î∞∞Ïó¥
        let usersLoaded = false; // ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïó¨Î∂Ä ÌôïÏù∏
        // Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ†® Î≥ÄÏàò
        let currentNotice = null;
        let originalNoticeContent = '';

        // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ ÏÉùÏÑ±
        function initializeApplicants() {
            days.forEach(day => {
                applicants[day] = {};
                zones.forEach(zone => {
                    applicants[day][zone.name] = [];
                });
            });
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.initializeApp = function () {
            console.log('Initializing application...');
            setCurrentWeekDates();
            setAdminWeekDates();
            loadZonesFromFirestore(); // Íµ¨Ïó≠ Î®ºÏ†Ä Î°úÎìú
            populateAdminUserSelect();
            loadDataFromFirestore();
            loadNoticeFromFirestore();

            document.getElementById('loginName').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        };

        // FirestoreÏóêÏÑú Íµ¨Ïó≠ Î™©Î°ù Î°úÎìú
        async function loadZonesFromFirestore() {
            try {
                const { collection, getDocs } = window.firestoreFunctions;
                const zonesRef = collection(window.db, 'zones');
                const querySnapshot = await getDocs(zonesRef);
                zones = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    zones.push({
                        id: doc.id,
                        name: data.name,
                        maxCapacity: data.maxCapacity || 4
                    });
                });
                console.log('Loaded zones from Firestore:', zones);
                initializeApplicants(); // zones Î°úÎìú ÌõÑ applicants Ï¥àÍ∏∞Ìôî
                updateZoneUI(); // UI ÏóÖÎç∞Ïù¥Ìä∏
                updateDisplay(); // Ïã†Ï≤≠ ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
            } catch (error) {
                console.error('Íµ¨Ïó≠ Î°úÎìú Ïò§Î•ò:', error);
                alert('Íµ¨Ïó≠ Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Íµ¨Ïó≠ UI ÎèôÏ†Å ÏóÖÎç∞Ïù¥Ìä∏ (Î™®Îã¨ Îì±)
        function updateZoneUI() {
            const zoneSelection = document.getElementById('zoneSelection');
            if (zoneSelection) {
                zoneSelection.innerHTML = '';
                zones.forEach((zone, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'zone-option';
                    optionDiv.innerHTML = `
                            <input type="radio" id="zone${index}" name="zone" value="${zone.name}">
                            <label for="zone${index}" class="zone-label" data-zone="${zone.name}">
                                ${zone.name}
                                <div class="capacity-info">0/${zone.maxCapacity}</div>
                            </label>
                        `;
                    zoneSelection.appendChild(optionDiv);
                });
            }

            const adminZoneSelection = document.getElementById('adminZoneSelection');
            if (adminZoneSelection) {
                adminZoneSelection.innerHTML = '';
                zones.forEach((zone, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'zone-option';
                    optionDiv.innerHTML = `
                            <input type="radio" id="admin-zone${index}" name="admin-zone" value="${zone.name}">
                            <label for="admin-zone${index}" class="zone-label" data-zone="${zone.name}">
                                ${zone.name}
                                <div class="capacity-info">0/${zone.maxCapacity}</div>
                            </label>
                        `;
                    adminZoneSelection.appendChild(optionDiv);
                });
            }
            console.log('Zone UI updated');
        }

        // FirestoreÏóêÏÑú ÏÇ¨Ïö©Ïûê Î™©Î°ù Î°úÎìú
        async function loadUsersFromFirestore() {
            if (usersLoaded) {
                console.log('Users already loaded, using cache');
                return;
            }

            try {
                console.log('Loading users from Firestore...');
                const { collection, getDocs } = window.firestoreFunctions;
                const usersRef = collection(window.db, 'users');
                const querySnapshot = await getDocs(usersRef);
                allowedUsers = [];
                querySnapshot.forEach((doc) => {
                    allowedUsers.push(doc.data().name);
                });
                usersLoaded = true;
                console.log('Loaded users from Firestore:', allowedUsers);
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Î°úÎìú Ïò§Î•ò:', error);
                alert('ÏÇ¨Ïö©Ïûê Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        function invalidateUsersCache() {
            usersLoaded = false;
            console.log('Users cache invalidated');
        }

        // FirestoreÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadDataFromFirestore() {
            try {
                console.log('Loading data from Firestore...');
                const { collection, onSnapshot, query, where } = window.firestoreFunctions;
                const applicantsRef = collection(window.db, 'applicants');
                const currentWeekDates = getCurrentWeekDates();
                const weekQuery = query(
                    applicantsRef,
                    where('actualDate', '>=', currentWeekDates.start),
                    where('actualDate', '<=', currentWeekDates.end)
                );

                onSnapshot(weekQuery, (querySnapshot) => {
                    console.log('Firestore snapshot received:', querySnapshot.size, 'documents');
                    initializeApplicants(); // applicants Í∞ùÏ≤¥ Ï¥àÍ∏∞Ìôî

                    allApplications = [];
                    userApplications = [];

                    querySnapshot.forEach((docSnap) => {
                        const data = docSnap.data();
                        const day = docSnap.id.split('_')[1]; // Ïòà: "2025-08-11_ÏõîÏöîÏùº" -> "ÏõîÏöîÏùº"
                        const zonesData = data.zones || {};

                        Object.keys(zonesData).forEach(zone => {
                            if (applicants[day] && applicants[day][zone]) {
                                applicants[day][zone] = zonesData[zone];
                                zonesData[zone].forEach(name => {
                                    allApplications.push({
                                        id: docSnap.id,
                                        name: name,
                                        day: day,
                                        zone: zone,
                                        actualDate: data.actualDate
                                    });
                                    if (name === currentUser) {
                                        userApplications.push({
                                            id: docSnap.id,
                                            name: name,
                                            day: day,
                                            zone: zone,
                                            actualDate: data.actualDate
                                        });
                                    }
                                });
                            }
                        });
                    });

                    console.log('All applications loaded:', allApplications);
                    updateDisplay();
                    if (document.getElementById('cancelModal').style.display === 'block') {
                        updateCancelList();
                    }
                    if (document.getElementById('statsModal').style.display === 'block') {
                        loadMonthlyStats();
                    }
                }, (error) => {
                    console.error('Firestore snapshot error:', error);
                    alert('Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                });
            } catch (error) {
                console.error('Firebase Ïó∞Í≤∞ Ïò§Î•ò:', error);
                alert('Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        // FirestoreÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        async function saveToFirestore(name, day, zone) {
            try {
                console.log(`Saving to Firestore: ${name}, ${day}, ${zone}`);
                const { collection, doc, setDoc, updateDoc, arrayUnion } = window.firestoreFunctions;
                const actualDate = getActualDateForDay(day);
                const docId = `${actualDate}_${day}`;
                const applicantsRef = doc(window.db, 'applicants', docId);

                const docSnap = await window.firestoreFunctions.getDoc(applicantsRef);
                if (docSnap.exists()) {
                    await updateDoc(applicantsRef, {
                        [`zones.${zone}`]: arrayUnion(name),
                        timestamp: new Date()
                    });
                } else {
                    await setDoc(applicantsRef, {
                        actualDate: actualDate,
                        zones: { [zone]: [name] },
                        timestamp: new Date()
                    });
                }
                console.log(`Document saved/updated with ID: ${docId}`);
                return true;
            } catch (error) {
                console.error('Ï†ÄÏû• Ïò§Î•ò:', error);
                alert('Ïã†Ï≤≠ Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                return false;
            }
        }

        // FirestoreÏóêÏÑú Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
        async function deleteFromFirestore(docId, application) {
            try {
                console.log('Deleting from Firestore:', docId, application);
                const { doc, updateDoc, arrayRemove } = window.firestoreFunctions;
                const applicantsRef = doc(window.db, 'applicants', docId);
                await updateDoc(applicantsRef, {
                    [`zones.${application.zone}`]: arrayRemove(application.name)
                });
                console.log('Application removed successfully');
                return true;
            } catch (error) {
                console.error('ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                alert('Ïã†Ï≤≠ Ï∑®ÏÜå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                return false;
            }
        }

        // FirestoreÏóê ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä
        async function addUserToFirestore(name) {
            try {
                const { collection, addDoc } = window.firestoreFunctions;
                const usersRef = collection(window.db, 'users');
                await addDoc(usersRef, { name: name });
                console.log('User added:', name);
                return true;
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä Ïò§Î•ò:', error);
                alert('ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                return false;
            }
        }

        // FirestoreÏóêÏÑú ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú
        async function deleteUserFromFirestore(docId) {
            try {
                const { deleteDoc, doc } = window.firestoreFunctions;
                await deleteDoc(doc(window.db, 'users', docId));
                console.log('User deleted with ID:', docId);
                return true;
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                alert('ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                return false;
            }
        }

        // FirestoreÏóê Íµ¨Ïó≠ Ï∂îÍ∞Ä
        async function addZoneToFirestore(name, maxCapacity) {
            try {
                const { collection, addDoc } = window.firestoreFunctions;
                const zonesRef = collection(window.db, 'zones');
                await addDoc(zonesRef, { name: name, maxCapacity: parseInt(maxCapacity) });
                console.log('Zone added:', name);
                return true;
            } catch (error) {
                console.error('Íµ¨Ïó≠ Ï∂îÍ∞Ä Ïò§Î•ò:', error);
                alert('Íµ¨Ïó≠ Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                return false;
            }
        }

        // FirestoreÏóêÏÑú Íµ¨Ïó≠ ÏÇ≠Ï†ú
        async function deleteZoneFromFirestore(docId) {
            try {
                const { deleteDoc, doc } = window.firestoreFunctions;
                await deleteDoc(doc(window.db, 'zones', docId));
                console.log('Zone deleted with ID:', docId);
                return true;
            } catch (error) {
                console.error('Íµ¨Ïó≠ ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                alert('Íµ¨Ïó≠ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                return false;
            }
        }

        // Î°úÍ∑∏Ïù∏ Ìï®Ïàò
        async function login() {
            const name = document.getElementById('loginName').value.trim();
            if (!name) {
                alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (name === 'admin') {
                currentUser = 'admin';
                isAdmin = true;
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminPage').style.display = 'block';
                console.log('Admin logged in');
                document.getElementById('noticeButton').style.display = 'block';
                return;
            }

            const { collection, getDocs, query, where } = window.firestoreFunctions;
            const usersRef = collection(window.db, 'users');
            const q = query(usersRef, where("name", "==", name));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                alert('Îì±Î°ùÎêòÏßÄ ÏïäÏùÄ Ï†ÑÎèÑÏù∏ÏûÖÎãàÎã§.');
                document.getElementById('loginName').value = '';
                return;
            }

            currentUser = name;
            isAdmin = false;
            document.getElementById('userInfo').textContent = `${currentUser}Îãò ÌôòÏòÅÌï©ÎãàÎã§!`;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            document.getElementById('noticeButton').style.display = 'block';
            filterUserApplications();
            updateCancelList();
            updateDisplay();
            console.log('User logged in:', currentUser);
            // ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ Ïãú (Í∏∞Ï°¥ ÏΩîÎìú Îã§ÏùåÏóê Ï∂îÍ∞Ä)
            currentUser = name;
            isAdmin = false;
            document.getElementById('userInfo').textContent = `${currentUser}Îãò ÌôòÏòÅÌï©ÎãàÎã§!`;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            filterUserApplications();
            updateCancelList();
            updateDisplay();

            // Í≥µÏßÄÏÇ¨Ìï≠ Î°úÎìú Ï∂îÍ∞Ä
            loadNoticeFromFirestore();

            console.log('User logged in:', currentUser);
        }

        // Í¥ÄÎ¶¨Ïûê ÏÇ¨Ïö©Ïûê ÏÑ†ÌÉù Î™©Î°ù Ï±ÑÏö∞Í∏∞
        async function populateAdminUserSelect() {
            const select = document.getElementById('adminUserSelect');
            if (!select) return;

            select.innerHTML = '<option value="">ÏÇ¨Ïö©ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';

            if (!usersLoaded) {
                await loadUsersFromFirestore();
            }

            allowedUsers.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                select.appendChild(option);
            });
            console.log('Admin user select populated from cache');
        }

        // ÏÇ¨Ïö©Ïûê Î™©Î°ù Î°úÎìú Î∞è ÌëúÏãú
        async function loadAndDisplayUsers() {
            const userManagementListEl = document.getElementById('userManagementList');
            userManagementListEl.innerHTML = '';

            const { collection, getDocs } = window.firestoreFunctions;
            const usersRef = collection(window.db, 'users');
            const querySnapshot = await getDocs(usersRef);

            const userCount = querySnapshot.size;
            const userListHeading = document.querySelector('#userManagementModal .user-list h3');
            userListHeading.textContent = `Îì±Î°ùÎêú ÏÇ¨Ïö©Ïûê (Ï¥ù ${userCount}Î™Ö)`;

            if (querySnapshot.empty) {
                userManagementListEl.innerHTML = '<p>Îì±Î°ùÎêú ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }

            querySnapshot.forEach((docSnap) => {
                const userData = docSnap.data();
                const userName = userData.name;
                const docId = docSnap.id;

                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                        <div class="user-name">${userName}</div>
                        <button class="btn danger small" onclick="deleteUser('${docId}', '${userName}')">ÏÇ≠Ï†ú</button>
                    `;
                userManagementListEl.appendChild(userItem);
            });
        }

        // ÏÉà ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä
        async function addNewUser() {
            const name = document.getElementById('newUserName').value.trim();
            if (!name) {
                alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const { collection, getDocs, query, where } = window.firestoreFunctions;
            const usersRef = collection(window.db, 'users');
            const q = query(usersRef, where("name", "==", name));
            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                alert('Ïù¥ÎØ∏ Îì±Î°ùÎêú ÏÇ¨Ïö©ÏûêÏûÖÎãàÎã§.');
                return;
            }

            const added = await addUserToFirestore(name);
            if (added) {
                alert(`${name}ÎãòÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`);
                document.getElementById('newUserName').value = '';
                invalidateUsersCache();
                loadUsersFromFirestore();
                populateAdminUserSelect();
                loadAndDisplayUsers();
            }
        }

        // ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú
        async function deleteUser(docId, userName) {
            if (confirm(`${userName}ÎãòÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                const deleted = await deleteUserFromFirestore(docId);
                if (deleted) {
                    alert(`${userName}ÎãòÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`);
                    invalidateUsersCache();
                    loadUsersFromFirestore();
                    populateAdminUserSelect();
                    loadAndDisplayUsers();
                }
            }
        }

        // Íµ¨Ïó≠ Î™©Î°ù Î°úÎìú Î∞è ÌëúÏãú
        async function loadAndDisplayZones() {
            const zoneManagementListEl = document.getElementById('zoneManagementList');
            zoneManagementListEl.innerHTML = '';

            const { collection, getDocs } = window.firestoreFunctions;
            const zonesRef = collection(window.db, 'zones');
            const querySnapshot = await getDocs(zonesRef);

            if (querySnapshot.empty) {
                zoneManagementListEl.innerHTML = '<p>Îì±Î°ùÎêú Íµ¨Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }

            querySnapshot.forEach((docSnap) => {
                const zoneData = docSnap.data();
                const zoneName = zoneData.name;
                const maxCapacity = zoneData.maxCapacity;
                const docId = docSnap.id;

                const zoneItem = document.createElement('div');
                zoneItem.className = 'user-item';
                zoneItem.innerHTML = `
                        <div class="user-name">${zoneName} (Ïö©Îüâ: ${maxCapacity})</div>
                        <button class="btn danger small" onclick="deleteZone('${docId}', '${zoneName}')">ÏÇ≠Ï†ú</button>
                    `;
                zoneManagementListEl.appendChild(zoneItem);
            });
        }

        // ÏÉà Íµ¨Ïó≠ Ï∂îÍ∞Ä
        async function addNewZone() {
            const name = document.getElementById('newZoneName').value.trim();
            const maxCapacity = document.getElementById('newZoneCapacity').value.trim();
            if (!name || !maxCapacity) {
                alert('Íµ¨Ïó≠ Ïù¥Î¶ÑÍ≥º Ïö©ÎüâÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const { collection, getDocs, query, where } = window.firestoreFunctions;
            const zonesRef = collection(window.db, 'zones');
            const q = query(zonesRef, where("name", "==", name));
            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                alert('Ïù¥ÎØ∏ Îì±Î°ùÎêú Íµ¨Ïó≠ÏûÖÎãàÎã§.');
                return;
            }

            const added = await addZoneToFirestore(name, maxCapacity);
            if (added) {
                alert(`${name} Íµ¨Ïó≠Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`);
                document.getElementById('newZoneName').value = '';
                document.getElementById('newZoneCapacity').value = '4';
                loadZonesFromFirestore();
                loadAndDisplayZones();
            }
        }

        // Íµ¨Ïó≠ ÏÇ≠Ï†ú
        async function deleteZone(docId, zoneName) {
            if (confirm(`${zoneName} Íµ¨Ïó≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                const deleted = await deleteZoneFromFirestore(docId);
                if (deleted) {
                    alert(`${zoneName} Íµ¨Ïó≠Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`);
                    loadZonesFromFirestore();
                    loadAndDisplayZones();
                }
            }
        }

        // Ïã†Ï≤≠ Î™®Îã¨ Ïó¥Í∏∞
        function openRegistrationModal() {
            document.getElementById('registrationModal').style.display = 'block';
            setCurrentWeekDates();
            updateZoneDisplayForModal();
            console.log('Registration modal opened');
        }

        // Ïã†Ï≤≠ Î™®Îã¨ Îã´Í∏∞
        function closeRegistrationModal() {
            document.getElementById('registrationModal').style.display = 'none';
            document.getElementById('registrationForm').reset();
            document.getElementById('zoneSelectionContainer').classList.remove('show');
            console.log('Registration modal closed');
        }

        // Ïã†Ï≤≠ Ï∑®ÏÜå Î™®Îã¨ Ïó¥Í∏∞
        function openCancelModal() {
            document.getElementById('cancelModal').style.display = 'block';
            filterUserApplications();
            updateCancelList();
            console.log('Cancel modal opened');
        }

        // Ïã†Ï≤≠ Ï∑®ÏÜå Î™®Îã¨ Îã´Í∏∞
        function closeCancelModal() {
            document.getElementById('cancelModal').style.display = 'none';
            console.log('Cancel modal closed');
        }

        // ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Î™®Îã¨ Ïó¥Í∏∞
        function openUserManagementModal() {
            document.getElementById('userManagementModal').style.display = 'block';
            loadAndDisplayUsers();
            populateAdminUserSelect();
            console.log('User management modal opened');
        }

        // ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Î™®Îã¨ Îã´Í∏∞
        function closeUserManagementModal() {
            document.getElementById('userManagementModal').style.display = 'none';
            console.log('User management modal closed');
        }

        // Íµ¨Ïó≠ Í¥ÄÎ¶¨ Î™®Îã¨ Ïó¥Í∏∞
        function openZoneManagementModal() {
            document.getElementById('zoneManagementModal').style.display = 'block';
            loadAndDisplayZones();
            console.log('Zone management modal opened');
        }

        // Íµ¨Ïó≠ Í¥ÄÎ¶¨ Î™®Îã¨ Îã´Í∏∞
        function closeZoneManagementModal() {
            document.getElementById('zoneManagementModal').style.display = 'none';
            console.log('Zone management modal closed');
        }

        // Îç∞Ïù¥ÌÑ∞ ÌÜµÍ≥Ñ Î™®Îã¨ Ïó¥Í∏∞
        function openStatsModal() {
            document.getElementById('statsModal').style.display = 'block';
            loadMonthlyStats();
            console.log('Stats modal opened');
        }

        // Îç∞Ïù¥ÌÑ∞ ÌÜµÍ≥Ñ Î™®Îã¨ Îã´Í∏∞
        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
            console.log('Stats modal closed');
        }

        // ÏõîÍ∞Ñ ÌÜµÍ≥Ñ Î°úÎìú
        async function loadMonthlyStats() {
            try {
                console.log('Loading monthly stats for:', currentStatsYear, currentStatsMonth);
                const { collection, getDocs, query, where } = window.firestoreFunctions;
                const applicantsRef = collection(window.db, 'applicants');
                const startDate = new Date(currentStatsYear, currentStatsMonth - 1, 1);
                const endDate = new Date(currentStatsYear, currentStatsMonth, 0);
                const startDateStr = getLocalDateString(startDate);
                const endDateStr = getLocalDateString(endDate);

                const monthQuery = query(
                    applicantsRef,
                    where('actualDate', '>=', startDateStr),
                    where('actualDate', '<=', endDateStr)
                );

                const querySnapshot = await getDocs(monthQuery);
                const monthlyData = [];
                const zoneStats = {};
                const dayStats = {};

                zones.forEach(zone => zoneStats[zone.name] = 0);
                days.forEach(day => dayStats[day] = 0);

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const day = doc.id.split('_')[1];
                    const zonesData = data.zones || {};
                    Object.keys(zonesData).forEach(zone => {
                        zonesData[zone].forEach(name => {
                            monthlyData.push({ name, day, zone, actualDate: data.actualDate });
                            if (zoneStats[zone] !== undefined) {
                                zoneStats[zone]++;
                            }
                            if (dayStats[day] !== undefined) {
                                dayStats[day]++;
                            }
                        });
                    });
                });

                displayMonthlyStats(monthlyData, zoneStats, dayStats);
            } catch (error) {
                console.error('ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïò§Î•ò:', error);
                alert('ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Î°úÏª¨ ÎÇ†Ïßú Î¨∏ÏûêÏó¥ ÏÉùÏÑ± Ìï®Ïàò
        function getLocalDateString(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        // ÏõîÍ∞Ñ ÌÜµÍ≥Ñ ÌôîÎ©¥Ïóê ÌëúÏãú
        function displayMonthlyStats(data, zoneStats, dayStats) {
            document.getElementById('currentMonth').textContent = `${currentStatsYear}ÎÖÑ ${currentStatsMonth}Ïõî`;

            const summaryEl = document.getElementById('statsSummary');
            const totalApplications = data.length;
            const uniqueUsers = new Set(data.map(d => d.name)).size;

            const zoneCounts = Object.values(zoneStats);
            const mean = totalApplications / zones.length;
            const variance = zoneCounts.reduce((acc, count) => acc + Math.pow(count - mean, 2), 0) / zones.length;
            const stdDev = Math.sqrt(variance);
            const imbalanceRate = mean > 0 ? (stdDev / mean) * 100 : 0;

            summaryEl.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${totalApplications}</div>
                        <div class="stat-label">Ï¥ù Ïã†Ï≤≠ Í±¥Ïàò</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${uniqueUsers}</div>
                        <div class="stat-label">Ï∞∏Ïó¨ Ïù∏Ïõê</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${imbalanceRate.toFixed(1)}%</div>
                        <div class="stat-label">Î∂àÍ∑†ÌòïÎ•†</div>
                    </div>
                `;

            const zoneStatsEl = document.getElementById('zoneStats');
            const maxZoneCount = Math.max(...Object.values(zoneStats));

            zoneStatsEl.innerHTML = '';
            zones.forEach(zone => {
                const count = zoneStats[zone.name] || 0;
                const percentage = maxZoneCount > 0 ? (count / maxZoneCount) * 100 : 0;
                const zoneCard = document.createElement('div');
                zoneCard.className = 'zone-stat-card';
                zoneCard.innerHTML = `
                        <div class="zone-stat-title">${zone.name}</div>
                        <div class="zone-stat-bar">
                            <div class="zone-stat-fill" style="width: ${percentage}%"></div>
                        </div>
                        <div class="zone-stat-text">${count}Í±¥ Ïã†Ï≤≠</div>
                    `;
                zoneStatsEl.appendChild(zoneCard);
            });
            console.log('Monthly stats displayed:', data.length, 'applications');
        }

        // Ïõî Î≥ÄÍ≤Ω
        function changeMonth(direction) {
            currentStatsMonth += direction;
            if (currentStatsMonth > 12) {
                currentStatsMonth = 1;
                currentStatsYear++;
            } else if (currentStatsMonth < 1) {
                currentStatsMonth = 12;
                currentStatsYear--;
            }
            loadMonthlyStats();
            console.log('Month changed to:', currentStatsYear, currentStatsMonth);
        }

        // ÌòÑÏû¨ Ï£ºÏùò ÎÇ†Ïßú Î≤îÏúÑ Í≥ÑÏÇ∞
        function getCurrentWeekDates() {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const saturday = new Date(sunday);
            saturday.setDate(sunday.getDate() + 6);
            return {
                start: getLocalDateString(sunday),
                end: getLocalDateString(saturday)
            };
        }

        // ÌäπÏ†ï ÏöîÏùºÏùò Ïã§Ï†ú ÎÇ†Ïßú Í≥ÑÏÇ∞
        function getActualDateForDay(dayName) {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const dayMap = {
                'ÏõîÏöîÏùº': 1, 'ÌôîÏöîÏùº': 2, 'ÏàòÏöîÏùº': 3, 'Î™©ÏöîÏùº': 4,
                'Í∏àÏöîÏùº': 5, 'ÌÜ†ÏöîÏùº': 6
            };
            const targetDate = new Date(sunday);
            targetDate.setDate(sunday.getDate() + dayMap[dayName]);
            return getLocalDateString(targetDate);
        }

        // ÌòÑÏû¨ Ï£ºÏùò Í∞Å ÏöîÏùº ÎÇ†Ïßú ÏÑ§Ï†ï
        function setCurrentWeekDates() {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const dayElements = [
                { id: 'monday-date', offset: 1 },
                { id: 'tuesday-date', offset: 2 },
                { id: 'wednesday-date', offset: 3 },
                { id: 'thursday-date', offset: 4 },
                { id: 'friday-date', offset: 5 },
                { id: 'saturday-date', offset: 6 }
            ];
            dayElements.forEach(day => {
                const date = new Date(sunday);
                date.setDate(sunday.getDate() + day.offset);
                const dateString = `${date.getMonth() + 1}/${date.getDate()}`;
                const element = document.getElementById(day.id);
                if (element) {
                    element.textContent = dateString;
                }
            });
            console.log('Current week dates set');
        }

        // Í¥ÄÎ¶¨Ïûê ÏöîÏùº ÎÇ†Ïßú ÏÑ§Ï†ï
        function setAdminWeekDates() {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const dayElements = [
                { id: 'admin-monday-date', offset: 1 },
                { id: 'admin-tuesday-date', offset: 2 },
                { id: 'admin-wednesday-date', offset: 3 },
                { id: 'admin-thursday-date', offset: 4 },
                { id: 'admin-friday-date', offset: 5 },
                { id: 'admin-saturday-date', offset: 6 }
            ];
            dayElements.forEach(day => {
                const date = new Date(sunday);
                date.setDate(sunday.getDate() + day.offset);
                const dateString = `${date.getMonth() + 1}/${date.getDate()}`;
                const element = document.getElementById(day.id);
                if (element) {
                    element.textContent = dateString;
                }
            });
            console.log('Admin week dates set');
        }

        // ÏÇ¨Ïö©Ïûê Ïã†Ï≤≠ ÌïÑÌÑ∞ÎßÅ
        function filterUserApplications() {
            if (!currentUser || isAdmin) {
                userApplications = [];
                return;
            }
            userApplications = allApplications.filter(a => a.name === currentUser);
            console.log('Filtered user applications:', userApplications);
        }

        // Ïã†Ï≤≠ Ï∑®ÏÜå Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateCancelList() {
            const cancelListEl = document.getElementById('cancelList');
            cancelListEl.innerHTML = '';

            if (userApplications.length === 0) {
                const noApplicationsDiv = document.createElement('div');
                noApplicationsDiv.className = 'no-applications';
                noApplicationsDiv.textContent = 'Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.';
                cancelListEl.appendChild(noApplicationsDiv);
                console.log('No user applications to display in cancel list');
                return;
            }

            userApplications.forEach(application => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'cancel-item';

                const infoDiv = document.createElement('div');
                infoDiv.className = 'cancel-info';

                const dayDiv = document.createElement('div');
                dayDiv.className = 'cancel-day';
                dayDiv.textContent = application.day;

                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'cancel-details';
                const dateParts = application.actualDate.split('-');
                const date = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                const dateString = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;
                detailsDiv.textContent = `${dateString} ‚Ä¢ ${application.zone}`;

                infoDiv.appendChild(dayDiv);
                infoDiv.appendChild(detailsDiv);

                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'btn danger';
                cancelBtn.textContent = 'Ï∑®ÏÜå';
                cancelBtn.onclick = () => confirmCancelApplication(application);

                itemDiv.appendChild(infoDiv);
                itemDiv.appendChild(cancelBtn);
                cancelListEl.appendChild(itemDiv);
            });
            console.log('User cancel list updated with', userApplications.length, 'items');
        }

        // Ïã†Ï≤≠ Ï∑®ÏÜå ÌôïÏù∏
        function confirmCancelApplication(application) {
            const dateParts = application.actualDate.split('-');
            const date = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
            const dateString = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;
            const confirmMessage = `${application.day}(${dateString}) ${application.zone} Ï†ÑÏãúÎåÄ Î¥âÏÇ¨ Ïã†Ï≤≠ÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;

            if (confirm(confirmMessage)) {
                cancelApplication(application.id, application);
            }
        }

        // Ïã†Ï≤≠ Ï∑®ÏÜå Ïã§Ìñâ
        async function cancelApplication(docId, application) {
            const deleted = await deleteFromFirestore(docId, application);
            if (deleted) {
                const dateParts = application.actualDate.split('-');
                const date = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                const dateString = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;
                alert(`${application.day}(${dateString}) ${application.zone} Ïã†Ï≤≠Ïù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.`);
                closeCancelModal();
            }
        }

        // Î™®Îã¨ÏóêÏÑú Íµ¨Ïó≠ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateZoneDisplayForModal() {
            document.querySelectorAll('.zone-label').forEach(label => {
                label.style.background = '';
                label.style.color = '';
                label.style.borderColor = '';
                label.style.cursor = 'pointer';
                label.previousElementSibling.disabled = false;
            });
            console.log('Zone display reset for modal');
        }

        // ÌäπÏ†ï ÏöîÏùºÏùò Íµ¨Ïó≠ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateZoneDisplay(selectedDay) {
            const zoneLabels = document.querySelectorAll('#zoneSelection .zone-label');
            zoneLabels.forEach(label => {
                const zoneName = label.dataset.zone;
                const zoneObj = zones.find(z => z.name === zoneName);
                const maxCapacity = zoneObj ? zoneObj.maxCapacity : 4;
                const currentCount = applicants[selectedDay][zoneName].length;
                const capacityInfo = label.querySelector('.capacity-info');
                const radioInput = label.previousElementSibling;

                capacityInfo.textContent = `${currentCount}/${maxCapacity}`;

                if (currentCount >= maxCapacity) {
                    label.style.background = '#ff6b6b';
                    label.style.color = 'white';
                    label.style.borderColor = '#ff6b6b';
                    label.style.cursor = 'not-allowed';
                    radioInput.disabled = true;
                } else {
                    if (!radioInput.checked) {
                        label.style.background = '';
                        label.style.color = '';
                        label.style.borderColor = '';
                    }
                    label.style.cursor = 'pointer';
                    radioInput.disabled = false;
                }
            });
            console.log('Zone display updated for day:', selectedDay);
        }

        // Ïã†Ï≤≠Ïûê Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateDisplay() {
            const applicantsListEl = document.getElementById('applicantsList');
            applicantsListEl.innerHTML = '';

            days.forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-section';

                const dayTitleDiv = document.createElement('div');
                dayTitleDiv.className = 'day-title';
                const dayDate = getDateForDay(day);
                dayTitleDiv.textContent = `${day} (${dayDate})`;
                dayDiv.appendChild(dayTitleDiv);

                zones.forEach(zone => {
                    const zoneApplicants = applicants[day][zone.name] || [];
                    const zoneDiv = document.createElement('div');
                    zoneDiv.className = 'zone-applicants';

                    const zoneNameDiv = document.createElement('div');
                    zoneNameDiv.className = 'zone-name';
                    zoneNameDiv.textContent = `${zone.name} (${zoneApplicants.length}/${zone.maxCapacity})`;

                    const applicantNamesDiv = document.createElement('div');
                    applicantNamesDiv.className = 'applicant-names';
                    if (zoneApplicants.length > 0) {
                        applicantNamesDiv.innerHTML = zoneApplicants
                            .map(name => `<span class="name-tag">${name}</span>`)
                            .join('');
                    } else {
                        applicantNamesDiv.textContent = 'Ïã†Ï≤≠Ïûê ÏóÜÏùå';
                    }

                    zoneDiv.appendChild(zoneNameDiv);
                    zoneDiv.appendChild(applicantNamesDiv);
                    dayDiv.appendChild(zoneDiv);
                });

                applicantsListEl.appendChild(dayDiv);
            });
            console.log('Applicants list updated');
        }

        // ÌäπÏ†ï ÏöîÏùºÏùò ÎÇ†Ïßú Í∞ÄÏ†∏Ïò§Í∏∞
        function getDateForDay(dayName) {
            const today = new Date();
            const currentDay = today.getDay();
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - currentDay);
            const dayMap = {
                'ÏõîÏöîÏùº': 1, 'ÌôîÏöîÏùº': 2, 'ÏàòÏöîÏùº': 3, 'Î™©ÏöîÏùº': 4,
                'Í∏àÏöîÏùº': 5, 'ÌÜ†ÏöîÏùº': 6
            };
            const targetDate = new Date(sunday);
            targetDate.setDate(sunday.getDate() + dayMap[dayName]);
            return `${targetDate.getFullYear()}/${targetDate.getMonth() + 1}/${targetDate.getDate()}`;
        }
        // ========== Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ†® Ìï®ÏàòÎì§ ==========

// FirestoreÏóêÏÑú Í≥µÏßÄÏÇ¨Ìï≠ Î°úÎìú
async function loadNoticeFromFirestore() {
    try {
        const { doc, getDoc } = window.firestoreFunctions;
        const noticeRef = doc(window.db, 'notices', 'current');
        const noticeSnap = await getDoc(noticeRef);
        
        if (noticeSnap.exists()) {
            currentNotice = noticeSnap.data();
            console.log('Notice loaded:', currentNotice);
        } else {
            currentNotice = null;
            console.log('No notice found');
        }
        
        updateNoticeButton();
        
        // Ï§ëÏöîÍ≥µÏßÄÏù¥Í≥† Î°úÍ∑∏Ïù∏Îêú ÏÇ¨Ïö©ÏûêÎùºÎ©¥ Î™®Îã¨ ÌëúÏãú
        if (currentNotice && currentNotice.isImportant && currentUser && !isAdmin) {
            setTimeout(() => {
                openNoticeViewModal();
            }, 500); // Î°úÍ∑∏Ïù∏ ÏôÑÎ£å ÌõÑ Ïû†Íπê ÎîúÎ†àÏù¥
        }
    } catch (error) {
        console.error('Í≥µÏßÄÏÇ¨Ìï≠ Î°úÎìú Ïò§Î•ò:', error);
    }
}

// Í≥µÏßÄÏÇ¨Ìï≠ Ï†ÄÏû•
async function saveNotice() {
    const content = document.getElementById('noticeContent').value.trim();
    const isImportant = document.getElementById('isImportantNotice').checked;
    
    if (!content) {
        alert('Í≥µÏßÄ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
    }
    
    if (content.length > 300) {
        alert('Í≥µÏßÄÏÇ¨Ìï≠ÏùÄ 300Ïûê Ïù¥ÎÇ¥Î°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
    }
    
    try {
        const { doc, setDoc } = window.firestoreFunctions;
        const noticeRef = doc(window.db, 'notices', 'current');
        
        const noticeData = {
            content: content,
            isImportant: isImportant,
            lastUpdated: new Date().toISOString(),
            updatedBy: 'admin',
            isActive: true
        };
        
        await setDoc(noticeRef, noticeData);
        
        currentNotice = noticeData;
        updateNoticeButton();
        
        alert('Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
        closeNoticeManagementModal();
        
        console.log('Notice saved:', noticeData);
    } catch (error) {
        console.error('Í≥µÏßÄÏÇ¨Ìï≠ Ï†ÄÏû• Ïò§Î•ò:', error);
        alert('Í≥µÏßÄÏÇ¨Ìï≠ Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    }
}

// Í≥µÏßÄÏÇ¨Ìï≠ ÏÇ≠Ï†ú
async function deleteNotice() {
    if (!currentNotice) {
        alert('ÏÇ≠Ï†úÌï† Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§.');
        return;
    }
    
    if (!confirm('Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        return;
    }
    
    try {
        const { doc, deleteDoc } = window.firestoreFunctions;
        const noticeRef = doc(window.db, 'notices', 'current');
        
        await deleteDoc(noticeRef);
        
        currentNotice = null;
        updateNoticeButton();
        
        alert('Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        closeNoticeManagementModal();
        
        console.log('Notice deleted');
    } catch (error) {
        console.error('Í≥µÏßÄÏÇ¨Ìï≠ ÏÇ≠Ï†ú Ïò§Î•ò:', error);
        alert('Í≥µÏßÄÏÇ¨Ìï≠ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    }
}

// Í≥µÏßÄ Í¥ÄÎ¶¨ Î™®Îã¨ Ïó¥Í∏∞
function openNoticeManagementModal() {
    document.getElementById('noticeManagementModal').style.display = 'block';
    
    // ÌòÑÏû¨ Í≥µÏßÄÏÇ¨Ìï≠ ÎÇ¥Ïö© Î°úÎìú
    if (currentNotice) {
        document.getElementById('noticeContent').value = currentNotice.content;
        document.getElementById('isImportantNotice').checked = currentNotice.isImportant || false;
        originalNoticeContent = currentNotice.content;
    } else {
        document.getElementById('noticeContent').value = '';
        document.getElementById('isImportantNotice').checked = false;
        originalNoticeContent = '';
    }
    
    updateCharCount();
    console.log('Notice management modal opened');
}

// Í≥µÏßÄ Í¥ÄÎ¶¨ Î™®Îã¨ Îã´Í∏∞
function closeNoticeManagementModal() {
    document.getElementById('noticeManagementModal').style.display = 'none';
    document.getElementById('noticeContent').value = '';
    document.getElementById('isImportantNotice').checked = false;
    console.log('Notice management modal closed');
}

// Í≥µÏßÄ Ìé∏Ïßë Ï∑®ÏÜå
function cancelNoticeEdit() {
    document.getElementById('noticeContent').value = originalNoticeContent;
    closeNoticeManagementModal();
}

// Í≥µÏßÄ ÌôïÏù∏ Î™®Îã¨ Ïó¥Í∏∞
function openNoticeViewModal() {
    if (!currentNotice) {
        alert('ÌòÑÏû¨ Îì±Î°ùÎêú Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§.');
        return;
    }
    
    document.getElementById('noticeViewModal').style.display = 'block';
    
    const titleElement = document.getElementById('noticeViewTitle');
    const contentElement = document.getElementById('noticeViewContent');
    const dateElement = document.getElementById('noticeViewDate');
    
    // Ï†úÎ™© ÏÑ§Ï†ï (Ï§ëÏöîÍ≥µÏßÄ Ïó¨Î∂ÄÏóê Îî∞Îùº)
    if (currentNotice.isImportant) {
        titleElement.textContent = 'üì¢ Ï§ëÏöî Í≥µÏßÄ';
        titleElement.className = 'important';
    } else {
        titleElement.textContent = 'üì¢ Í≥µÏßÄÏÇ¨Ìï≠';
        titleElement.className = 'normal';
    }
    
    // ÎÇ¥Ïö© ÏÑ§Ï†ï
    contentElement.textContent = currentNotice.content;
    
    // ÎÇ†Ïßú ÏÑ§Ï†ï
    const date = new Date(currentNotice.lastUpdated);
    const dateString = ` ${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} Îì±Î°ù`;
    dateElement.textContent = dateString;
    
    console.log('Notice view modal opened');
}

// Í≥µÏßÄ ÌôïÏù∏ Î™®Îã¨ Îã´Í∏∞
function closeNoticeViewModal() {
    document.getElementById('noticeViewModal').style.display = 'none';
    console.log('Notice view modal closed');
}

// Í≥µÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠ Ï≤òÎ¶¨
function handleNoticeButtonClick() {
    if (currentNotice) {
        openNoticeViewModal();
    } else {
        alert('ÌòÑÏû¨ Îì±Î°ùÎêú Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§.');
    }
}

// Í≥µÏßÄ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
function updateNoticeButton() {
    const button = document.getElementById('noticeButton');
    const badge = document.getElementById('noticeBadge');
    
    if (currentNotice && currentNotice.isActive) {
        button.className = 'notice-button active';
        badge.style.display = 'block';
    } else {
        button.className = 'notice-button inactive';
        badge.style.display = 'none';
    }
}

// Í∏ÄÏûêÏàò Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
function updateCharCount() {
    const content = document.getElementById('noticeContent').value;
    document.getElementById('noticeCharCount').textContent = content.length;
}

// Í∏ÄÏûêÏàò Ïπ¥Ïö¥Ìä∏ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
document.addEventListener('DOMContentLoaded', function() {
    const noticeContent = document.getElementById('noticeContent');
    if (noticeContent) {
        noticeContent.addEventListener('input', updateCharCount);
    }
});

        // ÏöîÏùº ÏÑ†ÌÉù Ïãú Íµ¨Ïó≠ ÏÑ†ÌÉù ÏòÅÏó≠ ÌëúÏãú
        document.querySelectorAll('input[name="day"]').forEach(radio => {
            radio.addEventListener('change', function () {
                const zoneContainer = document.getElementById('zoneSelectionContainer');
                if (this.checked) {
                    zoneContainer.classList.add('show');
                    updateZoneDisplay(this.value);
                    document.querySelectorAll('input[name="zone"]').forEach(zoneRadio => {
                        zoneRadio.checked = false;
                    });
                    console.log('Day selected:', this.value);
                    zoneContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Ìèº Ï†úÏ∂ú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        document.getElementById('registrationForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const selectedDay = document.querySelector('input[name="day"]:checked');
            const selectedZone = document.querySelector('input[name="zone"]:checked');

            if (!selectedDay) {
                alert('ÏöîÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                console.log('Form submission failed: No day selected');
                return;
            }
            if (!selectedZone) {
                alert('Íµ¨Ïó≠ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                console.log('Form submission failed: No zone selected');
                return;
            }

            const dayValue = selectedDay.value;
            const zoneValue = selectedZone.value;
            const zoneObj = zones.find(z => z.name === zoneValue);
            const maxCapacity = zoneObj ? zoneObj.maxCapacity : 4;

            if (applicants[dayValue][zoneValue].length >= maxCapacity) {
                alert(`${dayValue} ${zoneValue}ÏùÄ ÎßàÍ∞êÎêòÏóàÏäµÎãàÎã§.`);
                console.log('Form submission failed: Zone at max capacity');
                return;
            }

            let isDuplicate = false;
            zones.forEach(zone => {
                if (applicants[dayValue][zone.name].includes(currentUser)) {
                    isDuplicate = true;
                }
            });

            if (isDuplicate) {
                alert(`${dayValue}Ïóê Ïù¥ÎØ∏ Ïã†Ï≤≠ÌïòÏÖ®ÏäµÎãàÎã§.`);
                console.log('Form submission failed: Duplicate application');
                return;
            }

            const saved = await saveToFirestore(currentUser, dayValue, zoneValue);
            if (saved) {
                alert(`${dayValue} ${zoneValue} Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!`);
                closeRegistrationModal();
            }
        });

        // ÎßàÍ∞êÎêú Íµ¨Ïó≠ ÌÅ¥Î¶≠ Î∞©ÏßÄ
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('zone-label') && e.target.previousElementSibling.disabled) {
                e.preventDefault();
                const selectedDay = document.querySelector('input[name="day"]:checked') || document.querySelector('input[name="admin-day"]:checked');
                if (selectedDay) {
                    alert(`${selectedDay.value} ${e.target.dataset.zone}ÏùÄ ÎßàÍ∞êÎêòÏóàÏäµÎãàÎã§.`);
                }
            }
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        window.onclick = function (event) {
            const registrationModal = document.getElementById('registrationModal');
            const cancelModal = document.getElementById('cancelModal');
            const adminModal = document.getElementById('adminModal');
            const userManagementModal = document.getElementById('userManagementModal');
            const zoneManagementModal = document.getElementById('zoneManagementModal');
            const statsModal = document.getElementById('statsModal');
            const noticeManagementModal = document.getElementById('noticeManagementModal');
            const noticeViewModal = document.getElementById('noticeViewModal');

            if (event.target === registrationModal) {
                closeRegistrationModal();
            }
            if (event.target === cancelModal) {
                closeCancelModal();
            }
            if (event.target === adminModal) {
                closeAdminModal();
            }
            if (event.target === userManagementModal) {
                closeUserManagementModal();
            }
            if (event.target === zoneManagementModal) {
                closeZoneManagementModal();
            }
            if (event.target === statsModal) {
                closeStatsModal();
            }
            if (event.target === noticeManagementModal) {
                closeNoticeManagementModal();
            }
            if (event.target === noticeViewModal) {
                closeNoticeViewModal();
            }
        };

        // Í¥ÄÎ¶¨Ïûê Î™®Îã¨ Îã´Í∏∞
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        // Í¥ÄÎ¶¨Ïûê Ïï°ÏÖò Ïã§Ìñâ
        function executeAdminAction() {
            alert('Í¥ÄÎ¶¨Ïûê Ïï°ÏÖò Ïã§Ìñâ (Íµ¨ÌòÑ ÌïÑÏöî)');
        }

        // Í¥ÄÎ¶¨Ïûê Ìèº Ï¥àÍ∏∞Ìôî
        function resetAdminForm() {
            alert('Ìèº Ï¥àÍ∏∞Ìôî (Íµ¨ÌòÑ ÌïÑÏöî)');
        }</script>
</body>
</html>
